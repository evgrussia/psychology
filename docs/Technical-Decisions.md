# Технические решения и закрытие открытых вопросов

**Версия:** v1.0  
**Дата:** 7 января 2026  
**Статус:** ✅ Финализировано для релиза 1

---

## 1) Цель документа

Этот документ закрывает все открытые вопросы из PRD, Admin-Panel-Specification и других документов, фиксируя **окончательные технические решения** для релиза 1.

---

## 2) Решения по контенту и функционалу

### 2.1 ❓ Словарь терминов (`/glossary/`) — запускать в релизе 1?

**Решение:** ✅ **Да, запускать в релизе 1 (минимальная версия)**

**Обоснование:**
- SEO-преимущество (дополнительные точки входа)
- Показывает экспертность и прозрачность подхода
- Низкая сложность реализации (простые страницы с markdown)
- Можно запустить с минимальным набором (10-15 терминов)

**Минимальный набор для релиза 1 (15 терминов):**

**Подходы/методы (5):**
1. КПТ (когнитивно-поведенческая терапия)
2. ACT (терапия принятия и ответственности)
3. Схема-терапия
4. Mindfulness (Осознанность)
5. Экзистенциальная терапия

**Состояния/симптомы (5):**
6. Тревога
7. Выгорание
8. Панические атаки
9. Прокрастинация
10. Эмоциональное истощение

**Понятия/техники (5):**
11. Границы (психологические)
12. Триггеры
13. Копинг-стратегии
14. Самосострадание
15. Заземление (grounding)

**Формат:** 300-500 слов на термин, простой язык, без медицинского жаргона.

---

### 2.2 ❓ Подборки контента (`/curated/`) — запускать в релизе 1?

**Решение:** ✅ **Да, запускать в релизе 1 (минимальная версия)**

**Обоснование:**
- Улучшает навигацию по каталогу
- Сценарное мышление ("что почитать про тревогу")
- Удержание пользователей через "что ещё полезного"
- Можно запустить с 5 подборками (из приоритетных)

**Минимальный набор для релиза 1 (5 подборок):**

| ID | Название | Тема | Элементов | Приоритет |
|---|---|---|---|---|
| CUR-01 | Стартовый набор: тревога | anxiety | 7-10 | P0 |
| CUR-02 | Что делать с выгоранием | burnout | 7-10 | P0 |
| CUR-03 | Укрепить границы | boundaries | 5-7 | P0 |
| CUR-04 | Быстрые упражнения (1-3 мин) | any | 10-12 | P0 |
| CUR-05 | Подготовиться к первой встрече | any | 5-7 | P0 |

**Статус в админке:** полная реализация управления подборками (создание/редактирование/добавление элементов).

---

### 2.3 ❓ Точные формулировки вопросов QZ-01/02 — как решить?

**Решение:** ⚠️ **Валидация психологом обязательна, но не блокирует технологический старт**

**План действий:**
1. **До дизайна (сейчас):** использовать рабочие формулировки из Interactive-Modules-Matrix.md (QZ-01 — GAD-7 адаптированный, QZ-02 — MBI-inspired)
2. **Во время дизайна:** дизайнер создаёт макеты с рабочими формулировками
3. **Перед разработкой:** психолог валидирует/корректирует формулировки
4. **В процессе разработки:** финальные тексты вносятся через админку (не хардкод!)

**Критерий готовности:**
- Все вопросы проверены психологом на:
  - Бережность тона
  - Отсутствие клинических формулировок
  - Соответствие возрасту 18+
  - Ясность для пользователя

**Статус:** не блокирует дизайн/разработку, блокирует только публичный запуск.

---

### 2.4 ❓ Telegram: канал/бот/гибрид — что выбрать?

**Решение:** ✅ **Гибрид (канал + бот)**

**Обоснование:**
- **Канал** — для одностороннего контента (статьи, ресурсы, серии)
- **Бот** — для интерактивности (онбординг, консьерж записи, сохранение материалов, deep links)
- Комбинация даёт максимальную гибкость

**Архитектура:**

**Канал (`@emotional_balance_channel`):**
- Публичный или закрытый (по подписке)
- Контент: статьи, упражнения, анонсы мероприятий
- Частота: 2-3 поста в неделю
- Можно комментировать (если модерация включена)

**Бот (`@emotional_balance_bot`):**
- Онбординг (тема/частота)
- Серии: план на 7 дней, челлендж
- Консьерж записи (без обсуждения терапии)
- Сохранение материалов (кнопка "Сохранить в Telegram")
- Deep links для всех флоу

**Связка:**
- В канале кнопки "Взаимодействовать с ботом" для интерактивных действий
- В боте кнопки "Подписаться на канал"
- UTM/deep links для трекинга переходов

**События аналитики:**
- `tg_subscribe_confirmed` (для бота и канала отдельно)
- `tg_interaction` (только для бота)
- `tg_series_stopped`

---

## 3) Технические решения для админ-панели

### 3.1 ❓ Какой редактор контента: markdown или WYSIWYG?

**Решение:** ✅ **Markdown + live preview**

**Обоснование:**
- **Плюсы markdown:**
  - Простой синтаксис (легко выучить за 10 минут)
  - Чистый код (без лишних HTML-тегов)
  - Версионирование (diff легко читается)
  - Быстрая работа (нет тормозов WYSIWYG)
  - Портабельность (можно писать в любом редакторе)
  
- **Минусы WYSIWYG:**
  - Часто генерирует грязный HTML
  - Тормозит на больших текстах
  - Сложнее версионировать
  - Может ломать вёрстку неожиданно

**Реализация:**
- Редактор: markdown с подсветкой синтаксиса (например, CodeMirror или Monaco)
- Live preview: рядом окно с рендерингом (как GitHub)
- Toolbar: кнопки для часто используемых операций (жирный, курсив, ссылка, изображение)
- Шпаргалка: сворачиваемая панель с синтаксисом markdown

**Дополнительно:**
- Drag & drop изображений из медиа-библиотеки (автовставка markdown-ссылки)
- Autocomplete для внутренних ссылок

---

### 3.2 ❓ Нужен ли визуальный редактор навигатора (древо шагов)?

**Решение:** ⚠️ **Да, но для P1 (не блокирует релиз 1 MVP)**

**Обоснование:**
- **Без визуального редактора:** очень сложно поддерживать ветвящуюся логику (риск ошибок)
- **С визуальным редактором:** психолог может видеть всю структуру и легко менять связи
- **Но:** сложность реализации высокая (2-3 недели разработки)

**Решение для релиза 1 MVP:**
1. Навигатор запускается с **предзаданной структурой** (хардкод в коде)
2. Психолог может редактировать **только тексты** шагов/результатов через админку (простые текстовые поля)
3. Изменение структуры (добавление/удаление шагов, изменение связей) — через разработчика

**Решение для P1 (релиз 2):**
- Визуальный редактор (drag & drop, flowchart-style)
- Библиотеки: ReactFlow или Mermaid для визуализации
- Функции: добавление/удаление шагов, изменение связей, клонирование веток

**Приоритет:** P1 (важно, но не критично для запуска).

---

### 3.3 ❓ Хранение медиа: объектное хранилище или локально?

**Решение:** ✅ **Локальное файловое хранилище + раздача статики на VPS**

**Обоснование:**
- **Почему локально (для обычного VPS):**
  - Проще эксплуатация на старте: без ключей доступа/бакетов/ACL
  - Предсказуемая стоимость: диск VPS вместо отдельного object storage
  - Проще дебаг/восстановление: файлы лежат на сервере и попадают в бэкап как обычный каталог
  - Для MVP достаточно по нагрузке (изображения/PDF, ограниченные аудио)

- **Риски/ограничения локального хранения (учитываем в дизайне):**
  - Диск ограничен → вводим лимиты размеров и мониторинг места
  - Нет CDN → при необходимости подключаем CDN/прокси позже (P1)
  - Отказ диска = потеря медиа → обязательны offsite-бэкапы медиа

**Рекомендуемое решение (VPS):**
- **Хранилище:** каталог на сервере (например, `/var/lib/psychology/media`)
- **Раздача:** Nginx (или Caddy) как статика по URL `/media/*`
- **Запись:** только через backend API (RBAC), клиент не задаёт путь файла
- **Публичное чтение:** да (контентные медиа), приватные файлы — отдельной фичей (через авторизованный прокси)

---

### 3.4 ❓ Нужна ли мобильная версия админки для релиза 1?

**Решение:** ❌ **Нет, только desktop (1280×720+)**

**Обоснование:**
- Админка используется психологом/ассистентом с компьютера (операционная работа)
- Мобильная версия сложна в реализации (адаптивные таблицы, редакторы)
- Психолог не будет модерировать вопросы/редактировать контент с телефона (неудобно)
- Экономия времени разработки: 2-3 недели

**Минимальная адаптивность:**
- Планшет landscape (1024×768) — желательно, но не обязательно
- Телефон (< 768px) — не поддерживается (показывать сообщение "Используйте компьютер")

**Решение для P2 (если появится запрос):**
- Мобильное приложение (native или PWA) с ограниченным функционалом:
  - Просмотр дашборда
  - Модерация вопросов (одобрить/отклонить)
  - Уведомления о новых записях/вопросах

**Приоритет:** P2 (низкий).

---

### 3.5 ❓ Уровень детализации аналитики интерактивов (воронка по вопросам)?

**Решение:** ⚠️ **Базовая аналитика в релизе 1, детальная в P1**

**Релиз 1 (базовая):**
- Старты/завершения (completion rate)
- Распределение result_level (low/moderate/high)
- Среднее время прохождения
- CTA rate после результата

**P1 (детальная, не блокирует релиз):**
- Воронка по вопросам (на каком вопросе отваливаются)
- Распределение ответов (если не чувствительные)
- Популярность вариантов в навигаторе
- Heatmaps кликов

**Обоснование:**
- Базовой аналитики достаточно для измерения KPI из PRD
- Детальная аналитика полезна для оптимизации, но не критична для запуска
- Экономия времени разработки: 1-2 недели

**Приоритет детальной:** P1 (запустить после первых метрик).

---

## 4) Архитектурные решения

### 4.1 ❓ Синхронизация с Google Calendar: двусторонняя или односторонняя?

**Решение:** ✅ **Двусторонняя (с приоритетом на стороне продукта)**

**Обоснование:**
- **Импорт из Google Calendar:** автоматическая блокировка слотов (если психолог добавил личное событие в календарь)
- **Экспорт в Google Calendar:** психолог видит брони в своём календаре (удобно для напоминаний на телефоне)

**Конфликты:**
- Если бронь создана в продукте → приоритет у продукта (не даём удалять из календаря)
- Если событие создано в календаре → блокирует слот в продукте (автоматически)

**Реализация:**
- Google Calendar API (OAuth 2.0)
- Webhook для обновлений (если Google Calendar поддерживает)
- Синхронизация каждые 15 минут (фоновая задача)

---

### 4.2 ❓ Обязательна ли авторизация для интерактивов?

**Решение:** ❌ **Нет, интерактивы работают без авторизации (Privacy by design)**

**Обоснование:**
- PRD явно требует: "интерактивы без обязательного контакта" (FR-INT-1)
- Снижает барьер входа (пользователь получает пользу сразу)
- Соответствует Privacy by design (минимизация данных)

**Как работает:**
1. Пользователь проходит интерактив (гость)
2. Результат показывается сразу
3. CTA предлагает "Сохранить в Telegram" или "Записаться"
4. Если пользователь хочет сохранить в избранное → локальное хранение (localStorage)
5. Если пользователь регистрируется позже → возможность импорта из localStorage в аккаунт (опционально)

**Исключение:**
- Дневники (ЛК) — требуют авторизации (персональные данные)

---

### 4.3 ❓ Нужен ли A/B-тестинг в релизе 1?

**Решение:** ❌ **Нет, A/B-тестинг в P2**

**Обоснование:**
- A/B-Experiments-Plan.md детально описан процесс
- Но реализация инфраструктуры (флаги, рандомизация, дашборд) — 2-3 недели разработки
- Для первых недель после запуска достаточно анализа метрик без A/B

**Релиз 1:**
- Запуск без A/B-тестов
- Измерение baseline-метрик (30 дней)
- Сбор гипотез для тестирования

**P2 (через 30-60 дней после запуска):**
- Реализация A/B-инфраструктуры
- Первые эксперименты из AB-Experiments-Plan.md (например, EXP-HP-CTA-01)

**Приоритет:** P2 (важно для оптимизации, но не для запуска).

---

## 5) Операционные решения

### 5.1 ❓ Кто будет первым ассистентом/модератором?

**Решение:** ⚠️ **Пока только owner (психолог), ассистент — опционально**

**Обоснование:**
- На старте объём UGC небольшой (1-5 вопросов в день)
- Owner справится один(одна)
- Роли в админке реализованы → можно добавить ассистента когда нагрузка вырастет

**Триггер добавления ассистента:**
- Очередь модерации >10 вопросов постоянно
- Или время модерации >24 часа регулярно
- Или owner перегружен операционкой (расписание/лиды)

---

### 5.2 ❓ Нужен ли контент-редактор на старте?

**Решение:** ❌ **Нет, пока только owner**

**Обоснование:**
- Весь контент создаётся психологом (экспертность)
- Нет необходимости в отдельном редакторе на старте
- Роль реализована → можно добавить позже (если наймём контент-менеджера)

**Триггер добавления редактора:**
- Контента >50 статей (сложно поддерживать одному)
- Или наём специалиста по контент-маркетингу

---

### 5.3 ❓ Какая частота бэкапов?

**Решение:** ✅ **Ежедневные автоматические бэкапы**

**Обоснование:**
- Критичные данные: лиды, записи, платежи, дневники
- Потеря данных = репутационный риск
- Бэкапы должны быть автоматическими (не зависеть от человека)

**Реализация:**
- **База данных:** ежедневный dump в 3:00 UTC (минимальная нагрузка)
- **Медиа-файлы:** ежедневный бэкап каталога медиа (файловая система)
- **Хранение:** последние 30 дней (затем архив на 1 год)
- **Тестирование восстановления:** раз в месяц (убедиться что бэкапы работают)

**Место хранения бэкапов:**
- Другой регион/провайдер (не там же где основная БД)
- Рекомендация: offsite storage (SFTP/объектное хранилище/другой VPS) для каталогов `db_dumps/` и `media/`

---

## 6) Юридические и комплаенс-решения

### 6.1 ❓ Нужен ли DPO (Data Protection Officer)?

**Решение:** ⚠️ **Нет, но нужен internal compliance checklist**

**Обоснование:**
- Проект небольшой (не крупная организация)
- 152-ФЗ не требует обязательного DPO для ИП
- Но нужна ответственность за compliance (owner или юрист на аутсорсе)

**Минимум для релиза 1:**
- Политика конфиденциальности (проверена юристом)
- Согласие на обработку ПДн (отдельное для разных целей)
- Процедуры удаления данных по запросу (реализованы в ЛК)
- Аудит-лог критичных действий (реализован в админке)

**Рекомендация:**
- Консультация с юристом по 152-ФЗ перед запуском (разовая, 20-30 тыс. руб.)
- Годовой аудит compliance (опционально, если проект вырастет)

---

### 6.2 ❓ Нужна ли сертификация/аккредитация сайта как медицинского?

**Решение:** ❌ **Нет, это НЕ медицинский продукт**

**Обоснование:**
- Проект — психологическая поддержка (не медицина)
- Психолог — не врач (не ставит диагнозы, не назначает лекарства)
- Дисклеймеры на всех страницах: "не диагноз, не лечение, не экстренная помощь"

**Обязательные дисклеймеры (уже в PRD):**
- На интерактивах: "не диагноз, не экстренная помощь"
- В контенте: "не лечим, не гарантируем, может быть полезно"
- В футере: ссылка на экстренную помощь (112, телефон доверия)

---

## 7) Финальный чеклист готовности

### 7.1 Документация

- [x] PRD дополнен всеми требованиями
- [x] Tracking Plan полон (все события)
- [x] Формулы метрик определены
- [x] Admin-Panel-Specification создана
- [x] User Stories написаны
- [x] IA (Information Architecture) финализирована
- [x] Interactive-Modules-Matrix детализирована
- [x] UGC-Moderation-Rules описаны
- [x] AB-Experiments-Plan составлен
- [x] Telegram-Deep-Links-Schema определена
- [x] **Technical-Decisions закрыты** ← этот документ

### 7.2 Открытые вопросы

- [x] Словарь/подборки: запускать в релизе 1? → **Да, минимальные версии**
- [x] Telegram: канал/бот/гибрид? → **Гибрид (канал + бот)**
- [x] Редактор контента: markdown/WYSIWYG? → **Markdown + live preview**
- [x] Визуальный редактор навигатора? → **P1 (не блокирует релиз 1)**
- [x] Хранение медиа: объектное хранилище/локально? → **Локальное + статика на VPS**
- [x] Мобильная версия админки? → **Нет, только desktop**
- [x] Детализация аналитики интерактивов? → **Базовая в релизе 1, детальная в P1**
- [x] Синхронизация Google Calendar? → **Двусторонняя**
- [x] A/B-тестинг в релизе 1? → **Нет, в P2**
- [x] Частота бэкапов? → **Ежедневно**
- [ ] **Точные формулировки вопросов QZ-01/02** → валидация психологом (не блокирует технологический старт)

**Итого закрыто:** 10 из 11 вопросов (91%)  
**Не блокирует разработку:** 1 вопрос (валидация контента психологом, делается параллельно)

### 7.3 Технический стек (рекомендации)

**Не обязательно фиксировать сейчас, но для полноты:**

**Backend:**
- Node.js (Express/NestJS) или Python (FastAPI/Django)
- PostgreSQL (основная БД)
- Redis (кэш/сессии)

**Frontend:**
- React/Next.js или Vue/Nuxt
- TypeScript
- Tailwind CSS или styled-components

**Инфраструктура:**
- Yandex Cloud / VK Cloud (если РФ)
- VPS + Nginx/Caddy (раздача статики и API)
- Google Calendar API (расписание)
- ЮKassa API (платежи)
- Telegram Bot API

**Аналитика:**
- Собственная БД (события из Tracking Plan)
- Опционально: Amplitude/Mixpanel (для удобных дашбордов)

---

## 12) Решения по тестированию

### 12.1 ❓ Какая стратегия и стек тестирования?

**Решение:** ✅ **Комплексное тестирование (Pyramid of Testing) с изоляцией в Docker**

**Обоснование:**
- Высокая критичность данных (ПДн, дневники) требует надежного покрытия.
- Clean Architecture упрощает unit-тестирование доменной логики.
- Изоляция в Docker предотвращает конфликты данных.

**Стек:**
- **Backend**: Jest (Unit/E2E), Supertest.
- **Frontend**: Vitest (Unit/Component), Playwright (E2E).
- **Инфраструктура**: Docker Compose (PostgreSQL, Redis).

**Принципы:**
- БД очищается перед/после тестов.
- Автоматические миграции для тестовой БД.
- Smoke-тесты для CI/CD.

---

## 13) Итоговая оценка готовности

| Категория | Статус | Комментарий |
|---|---|---|
| **Функциональные требования** | ✅ 100% | PRD дополнен всеми FR-ADM |
| **Технические спецификации** | ✅ 100% | Admin-Panel-Spec, Tracking Plan, Формулы метрик |
| **Контент-план** | ✅ 100% | Минимумы определены, валидация психолога параллельна |
| **Безопасность/этика** | ✅ 100% | UGC-Moderation, Privacy by design |
| **Аналитика** | ✅ 100% | Все метрики определены, события полны |
| **Roadmap** | ✅ 100% | P0/P1/P2 приоритизированы |
| **Админ-панель** | ✅ 100% | Детальная спецификация, решения по всем вопросам |
| **Открытые вопросы** | ✅ 91% | 10 из 11 закрыты, 1 не блокирует |

**Общая готовность к дизайну и разработке:** ✅ **100%**

---

## 9) Следующие шаги (исполнение)

### 9.1 Дизайн (можно начинать прямо сейчас)

**Приоритет 1 (критичные экраны):**
1. Главная (путь клиента)
2. Лендинг темы (например, тревога)
3. Квиз QZ-01 (от превью до результата)
4. Навигатор состояния (NAV-01)
5. Запись: календарь → анкета → оплата → подтверждение
6. Админка: дашборд, расписание, модерация UGC

**Приоритет 2 (важные, но не блокируют):**
7. Блог/статьи (шаблон страницы)
8. Ресурсы (упражнения, аудио)
9. О психологе / Как проходит
10. ЛК клиента: дневники, встречи
11. Админка: контент (редактор), интерактивы (редакторы)

**Входные данные:**
- UI-Kit-Design-System.md (полная дизайн-система)
- Wireframes-Figma.md (прототипы)
- Content-Guide-UX-Copywriting.md (тон, копи)
- User-Stories + acceptance criteria

### 9.2 Разработка (после дизайна)

**Спринт 1 (инфраструктура, 2 недели):**
- Настройка окружений (dev/stage/prod)
- База данных (схема)
- Авторизация/роли (RBAC)
- Интеграции (Google Calendar, ЮKassa, Telegram Bot API)
- Медиа-хранилище (локальная ФС + статика на VPS)

**Спринт 2-3 (публичная часть, 3-4 недели):**
- Главная, лендинги тем
- Интерактивы (квизы, навигатор, термометр, скрипты, ритуалы)
- Контент (статьи, ресурсы, подборки, словарь)
- Блоги/CTA

**Спринт 4-5 (запись и оплата, 3 недели):**
- Расписание/слоты (синхронизация с Google Calendar)
- Календарь выбора слота
- Анкета, согласия
- Интеграция ЮKassa
- Подтверждение/уведомления

**Спринт 6 (Telegram, 2 недели):**
- Бот: онбординг, серии, консьерж
- Канал: настройка, контент-план
- Deep links, UTM

**Спринт 7-8 (ЛК и админка, 3-4 недели):**
- ЛК: дневники, встречи, экспорт PDF
- Админка: дашборд, расписание, услуги
- Админка: контент (CMS)
- Админка: интерактивы (редакторы текстов)
- Админка: CRM-лиды
- Админка: модерация UGC
- Админка: аналитика (базовая)

**Спринт 9 (тестирование, багфиксы, 2 недели):**
- QA всех флоу
- Багфиксы
- Перформанс-оптимизация
- A11Y (базовая)
- Security audit

**Итого:** ~20 недель (5 месяцев) разработки

### 9.3 Контент (параллельно с разработкой)

**Месяц 1-2:**
- Валидация вопросов квизов (психолог)
- Написание 10-15 статей (стартовый набор)
- Создание 10-15 ресурсов (упражнения/чек-листы)
- Написание 15 терминов для словаря
- Создание 5 подборок
- Запись 5-10 аудио мини-ритуалов

**Месяц 3-4:**
- Продолжение наполнения контента (до 30-50 элементов к запуску)
- Шаблоны сообщений (email/Telegram)
- Тексты для страниц доверия (О психологе, Как проходит, FAQ)

---

## 10) Риски и митигация

### 10.1 Риск: Психолог не успевает валидировать вопросы квизов

**Митигация:**
- Начать валидацию сейчас (параллельно с дизайном)
- Если не успевает → запустить без квизов (остальные интерактивы работают)
- Или запустить с 1 квизом (QZ-01, тревога — самый частый запрос)

### 10.2 Риск: Telegram Bot API изменится

**Митигация:**
- Использовать официальную библиотеку (node-telegram-bot-api или аналог)
- Мониторить changelog Telegram Bot API
- Версионировать API-запросы

### 10.3 Риск: ЮKassa изменит условия/комиссии

**Митигация:**
- Заложить 1-2% буфер на комиссии в цены услуг
- Иметь запасной платёжный провайдер (например, Тинькофф Касса)
- Мониторить новости ЮKassa

### 10.4 Риск: Не хватит времени на все P0-функции

**Митигация:**
- Приоритизировать внутри P0 (что критичнее)
- Минимальная версия словаря/подборок (можно сократить до 5 терминов, 3 подборок)
- Отложить мероприятия в P1 (если совсем критично по времени)

---

## 11) Заключение

✅ **Все критические открытые вопросы закрыты**

✅ **Технические решения зафиксированы**

✅ **Готовность к дизайну и разработке: 100%**

**Можно начинать дизайн прямо сейчас.**

---

**Версия документа:** 1.0  
**Дата:** 7 января 2026  
**Статус:** ✅ Финализировано  
**Следующий review:** перед запуском релиза 1 (проверить актуальность решений)
