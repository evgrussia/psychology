# Шаблон: Техническая спецификация фичи (Tech Spec)

**Проект:** «Эмоциональный баланс»  
**Версия спеки:** v0.1 (draft)  
**Автор:** \<имя\>  
**Дата:** \<YYYY-MM-DD\>  
**Статус:** draft / review / approved / implemented  

**Feature ID:** `FEAT-____-__` (см. `docs/Roadmap-Backlog.md`)  
**Epic:** `EPIC-__`  
**Приоритет:** P0 / P1 / P2  
**Трекер:** \<ссылка на тикет/эпик\>  

---

## 1) Summary (коротко)

### 1.1 Что делаем
1–3 предложения: какую пользовательскую проблему решаем и где это будет видно пользователю.

### 1.2 Почему сейчас (контекст / метрики / риск)
- **Сигнал/боль:** \<что болит\>
- **Ожидаемый эффект:** \<какую метрику двигаем\>
- **Если не сделать:** \<риск\>

### 1.3 Ссылки на первоисточники
- PRD: `docs/PRD.md` (раздел/FR)
- Flows: `docs/user-flows-cjm.md`
- IA: `docs/information-architecture.md`
- Tracking: `docs/Tracking-Plan.md`
- A11y: `docs/Accessibility-A11y-Requirements.md`
- Data model: `docs/Модель-данных.md`
- Domain model: `docs/Domain-Model-Specification.md`

---

## 2) Goals / Non-goals

### 2.1 Goals (что обязательно)
- **G1:** …
- **G2:** …

### 2.2 Non-goals (что осознанно НЕ делаем)
- **NG1:** …
- **NG2:** …

---

## 3) Scope (границы и сценарии)

### 3.1 In-scope (конкретные сценарии)
- **US-1:** \<сценарий\>
- **US-2:** \<сценарий\>

### 3.2 Out-of-scope
- …

### 3.3 Acceptance criteria (AC)
> Короткие, проверяемые, без “примерно”.
- [ ] AC-1 …
- [ ] AC-2 …

### 3.4 Негативные сценарии (обязательные)
- **NS-1:** \<ошибка/пусто/нет доступа/нет слотов/ошибка оплаты\>
- **NS-2:** \<деградация интеграции\>

---

## 4) UX / UI (что увидит пользователь)

### 4.1 Изменения экранов/страниц
- **Маршруты/страницы:** \<URL из IA\>
- **Состояния UI:** loading / empty / error / success
- **Копирайт/тон:** бережно, без давления (см. `docs/Content-Guide-UX-Copywriting.md`)

### 4.2 A11y (минимум)
- [ ] Навигация с клавиатуры
- [ ] Видимый фокус
- [ ] Семантические роли/лейблы
- [ ] Контраст

---

## 5) Архитектура и ответственность слоёв (Clean Architecture)

> Описать на уровне модулей/слоёв. Зависимости направлены внутрь.

### 5.1 Компоненты/модули
- **Presentation:** …
- **Application (Use Cases):** …
- **Domain:** …
- **Infrastructure:** …

### 5.2 Основные use cases (сигнатуры)
- `…UseCase.execute(input): output`

### 5.3 Доменные события (если нужны)
- **Event:** `…Happened`
  - payload: \<без PII/чувствительного текста, если не нужно\>
  - consumers: \<кто слушает\>

---

## 6) Модель данных (БД) и миграции

### 6.1 Новые/изменённые сущности
- **Table/Entity:** …
  - поля: …
  - индексы/уникальности: …
  - политика хранения (TTL/удаление): …

### 6.2 P0/P1/P2 классификация данных
> Обязательный блок для privacy by design.
- **P0 (safe):** …
- **P1 (PII):** …
- **P2 (sensitive):** …

### 6.3 Миграции
- **Migration plan:** forward / rollback
- **Backfill:** нужен/не нужен; как долго; риски

---

## 7) API / Контракты (если применимо)

### 7.1 Public API (web)
| Endpoint | Method | Auth | Request | Response | Ошибки |
|---|---:|---|---|---|---|
| `/...` | GET/POST | public/auth | … | … | … |

### 7.2 Admin API
| Endpoint | Method | Role | Назначение |
|---|---:|---|---|
| `/admin/...` | POST | owner/editor | … |

### 7.3 Интеграции (внешние)
> Для каждой интеграции указать идемпотентность и деградацию.
- **Google Calendar:** \<что читаем/пишем\>, частота sync, webhook/поллинг, конфликты.
- **ЮKassa:** создание платежа + webhooks, idempotency key, обработка повторов.
- **Telegram:** deep links payload без PII, mapping `deep_link_id`, TTL.
- **Email:** шаблоны, retry policy.

---

## 8) Tracking / Analytics (по `docs/Tracking-Plan.md`)

### 8.1 События (таблица)
| Event name | Source | Когда срабатывает | Props (P0-only) | Запреты (PII/текст) |
|---|---|---|---|---|
| `...` | web/backend/tg/admin | … | … | … |

### 8.2 Воронка / метрики успеха
- **Primary KPI:** …
- **Secondary KPI:** …

---

## 9) Security / Privacy / Compliance

### 9.1 Privacy by design (обязательные пункты)
- [ ] В аналитике нет PII и свободного текста
- [ ] P2 данные (если есть) шифруются “в покое”
- [ ] Раздельные согласия (если собираем контакт/коммуникации)
- [ ] Пользователь может удалить/экспортировать данные (если применимо)

### 9.2 RBAC и аудит
- **Кто видит P2:** …
- **Какие действия пишем в audit log:** …

### 9.3 Кризисный режим (если применимо)
- Триггеры: …
- Поведение UI/CTA: …
- Логи/алерты: …

---

## 10) Надёжность, производительность, деградации

### 10.1 SLA/SLO (если критично)
- **SLO:** …

### 10.2 Retry / idempotency
- где ретраи допустимы, где запрещены

### 10.3 Деградации (fallback)
- что показываем пользователю при сбое интеграции/таймауте

---

## 11) Rollout plan

### 11.1 Фича‑флаг / поэтапное включение
- **flag:** `...`
- аудитория: internal → 10% → 50% → 100%

### 11.2 Миграция данных и обратимость
- можно ли откатить без потерь

### 11.3 Коммуникации (если нужно)
- тексты/FAQ/инструкция в админке

---

## 12) Test plan

### 12.1 Unit tests
- …

### 12.2 Integration tests
- …

### 12.3 E2E (критические happy paths)
- …

### 12.4 Проверка privacy
- [ ] события не содержат запрещённых полей
- [ ] P2 не попадает в логи/ошибки

### 12.5 A11y smoke
- [ ] клавиатура
- [ ] фокус
- [ ] скринридер (минимум)

---

## 13) Open questions / решения

### 13.1 Вопросы
- [ ] Q1 …
- [ ] Q2 …

### 13.2 Decision log (что и почему решили)
- **2026-..-..:** …

