# Accessibility (a11y) требования

**Проект:** «Эмоциональный баланс»  
**Версия:** v1.0 (основной документ, Release 1)  
**Дата:** 2026-01-07  
**Трассировка:** PRD `NFR-A11Y-1` — базовая доступность (контраст, фокус, клавиатура, семантика)  

Связанные документы:
- `docs/PRD.md` (NFR)
- `docs/User-Stories-JTBD-Acceptance-Criteria.md` (EPIC L / US-UX-02)
- `docs/UI-Kit-Design-System.md` (контраст, focus styles, reduced-motion, touch targets)
- `docs/generated/frontend/QPsychology-Complete-Design-Specification.md` (skip-link, aria patterns, focus trap)

---

## 1) WCAG-цели и область применения

### 1.1 Цель соответствия

**Цель релиза 1:** соответствие **WCAG 2.2 Level AA** для публичной части и ключевых сценариев:
- Главная/хабы/лендинги/контент
- Интерактивы (квизы/«первый шаг») + результаты
- Booking-флоу (услуга → слот → анкета → согласия → оплата → подтверждение)
- Юридические/служебные страницы (политики/дисклеймеры/экстренная помощь)

**Стратегия:** “AA по умолчанию”, а где возможно — **улучшения поверх AA** (например, более высокий контраст для текста, более заметный фокус, упрощение языка).

### 1.2 Definition of Done (DoD) по доступности

Фича/экран считается готовым, если:
- доступен **полностью с клавиатуры** (без мыши);
- **фокус всегда видим** и не теряется;
- **контраст** соответствует заданным порогам;
- **семантика и названия** элементов корректны для screen reader;
- динамические элементы (меню/модалки/аккордеоны) правильно управляют фокусом и состояниями.

---

## 2) Клавиатурная навигация (обязательные правила)

### 2.1 Общие требования

- **Tab / Shift+Tab**: проходят по всем интерактивным элементам в **логичном порядке** (сверху-вниз, слева-направо, по смыслу).
- **Enter/Space**: активируют кнопки и контролы (в зависимости от нативного поведения).
- **Esc**: закрывает модальные/оверлейные поверхности (меню, модалки, поиск), если они закрываемые.
- **Не должно быть “клавиатурных ловушек”** (кроме осознанного focus-trap внутри модалок/оверлеев).
- **Фокус не должен уходить под оверлей**: при открытом диалоге/меню фон недоступен для таба.

### 2.2 Skip-link (быстрый переход к контенту)

- На всех публичных страницах есть **skip-link** “Перейти к основному содержимому”.
- Skip-link:
  - появляется при фокусе;
  - ведёт на валидный якорь (например, `#main-content` на `<main>`).

### 2.3 Меню, модалки, оверлеи: управление фокусом

Для **dialog/menu/overlay** обязательно:
- **При открытии**: фокус переводится на первый интерактивный элемент (или на заголовок диалога при необходимости чтения).
- **Во время открытия**: включается **focus trap** внутри контейнера.
- **При закрытии**: фокус возвращается на **триггер**, который открыл поверхность.
- **Закрытие по Esc**: работает стабильно и не ломает фокус.

### 2.4 Аккордеоны/раскрывающиеся блоки

- Заголовок — **кнопка** (не `<div>`), доступная по Tab.
- Состояние раскрытия объявляется через `aria-expanded` + `aria-controls`.
- Контент скрывается так, чтобы screen reader не читал его в закрытом состоянии (например, через `hidden`/`aria-hidden` по паттерну компонента).

---

## 3) Фокус: видимость, стиль, последовательность

### 3.1 Видимый фокус (обязателен везде)

- У всех интерактивных элементов есть **видимое состояние фокуса**.
- Используем `:focus-visible` (а не `:focus`), чтобы не создавать “обводку” только от мыши.

Рекомендуемый базовый стиль (согласован с UI Kit):
- толщина обводки: **минимум 3px**;
- `outline-offset`: **2–3px**;
- фокус не перекрывается тенями/оверлеями и имеет достаточный контраст (см. раздел 4).

### 3.2 Порядок фокуса

- Порядок фокуса следует **визуальному и смысловому порядку**.
- Запрещено создавать “скачки” фокуса из-за неверных `tabindex` (например, `tabindex` > 0 не используем).

---

## 4) Контраст, цвета, индикации (WCAG AA минимум)

### 4.1 Пороги контрастности

Пороговые значения (как в `docs/UI-Kit-Design-System.md`):
- **Обычный текст**: минимум **4.5:1**
- **Крупный текст** (≈18px+ или 14px+ bold): минимум **3:1**
- **UI-элементы и графические компоненты** (иконки, границы, контролы, focus outline): минимум **3:1**

### 4.2 Цвет — не единственный носитель смысла

Запрещено передавать смысл только цветом:
- Ошибка = не только “красная рамка”, но и **текст ошибки**, иконка/лейбл, плюс `aria-invalid` (см. формы).
- Ссылки = различимы не только цветом: **underline** (минимум в обычном состоянии или на hover/focus; для контентных ссылок — предпочтительно всегда).

### 4.3 Проверка контраста (обязательный этап)

- Проверяем контраст текста/иконок/границ и focus-индикатора инструментами:
  - WebAIM Contrast Checker
  - axe / Lighthouse (как доп.проверка, не единственная)

### 4.4 High-contrast предпочтения ОС/браузера

- Учитываем `@media (prefers-contrast: high)`:
  - усиливаем фокус (толще/больше offset);
  - не ломаем читаемость на системных high-contrast режимах.

---

## 5) Семантика и screen reader (минимум для релиза 1)

### 5.1 Семантическая разметка и ориентиры (landmarks)

- На странице есть корректные ориентиры: `header`, `nav`, `main`, `footer`.
- Ровно один `h1` на страницу, дальше иерархия без пропусков.

### 5.2 Правильные элементы управления

- Кнопка действия = `<button>`.
- Навигационный переход = `<a href="...">`.
- Инпуты имеют связанный `<label>` (не только placeholder).

### 5.3 ARIA — только когда нужно

- Не “дублируем” нативную семантику ARIA-атрибутами.
- Там, где ARIA нужна (dialog, accordion, live-region, toggle-кнопки):
  - состояние (`aria-expanded`, `aria-pressed`, `aria-selected`) всегда соответствует UI;
  - `aria-controls` указывает на существующий `id`;
  - диалог имеет `role="dialog"` + `aria-modal="true"` + корректное имя (`aria-labelledby` или `aria-label`).

### 5.4 Динамические обновления

- Если контент обновляется без перезагрузки (ошибка оплаты, “нет слотов”, подсказка), используем корректные live region’ы:
  - `aria-live="polite"` для не критичных сообщений;
  - `aria-live="assertive"` — только для действительно критичных.

---

## 6) Формы (анкета/согласия/оплата): обязательные требования

### 6.1 Лейблы, подсказки, ошибки

- Каждый контрол формы имеет:
  - визуальный `<label>`;
  - при необходимости — helper text;
  - при ошибке — текст ошибки, связанный через `aria-describedby`.
- Ошибочный контрол:
  - получает `aria-invalid="true"`;
  - фокус переводится на **первую ошибку** после сабмита (или показывается error summary с ссылками-якорями).

### 6.2 Обязательные поля и согласия

- Required-поля обозначены **понятно** (не только “*”) и объявлены для screen reader (например, через текст “обязательное поле” или `aria-required`).
- Согласия кликабельны и с текстом достаточной длины; чекбоксы имеют чёткие подписи.

---

## 7) Медиа/изображения

- Все содержательные изображения имеют **alt-text** (см. чеклист в `docs/design-system/Image-Generation-Prompts.md`).
- Декоративные изображения: `alt=""` (пустой alt) и скрыты от screen reader при необходимости.
- Видео (если есть): субтитры/транскрипт — планируем как отдельное требование по мере появления видео.

---

## 8) Анимации и чувствительность к движению

- Уважаем `prefers-reduced-motion: reduce`:
  - анимации и плавные скроллы отключаются/минимизируются;
  - не должно быть критичных функций, завязанных на анимации.
- Запрещены мерцания, которые могут спровоцировать фоточувствительность (классическая зона риска: частые вспышки/строб).

---

## 9) Размеры тач-таргетов (mobile)

Как в UI Kit:
- минимальный размер интерактивной области: **44×44 px**
- расстояние между соседними тач-таргетами: минимум **8 px** (по возможности больше)

---

## 10) Мини-чеклист (для PR перед мерджем)

### 10.1 WCAG/визуальные критерии
- [ ] Контраст текста ≥ 4.5:1 (крупный ≥ 3:1)
- [ ] Контраст UI/фокуса ≥ 3:1
- [ ] Ссылки различимы не только цветом (underline/стили)

### 10.2 Клавиатура/фокус
- [ ] Все интерактивные элементы доступны с Tab/Shift+Tab
- [ ] Фокус видим везде (focus-visible), не перекрывается
- [ ] Есть skip-link на основной контент
- [ ] Модалки/оверлеи: focus trap + Esc + возврат фокуса на триггер

### 10.3 Семантика/скринридер
- [ ] Корректные landmarks (`header/nav/main/footer`) и иерархия заголовков
- [ ] Формы: label + aria-describedby для ошибок + aria-invalid
- [ ] Accordion/menu/dialog имеют корректные aria-атрибуты
- [ ] Изображения: alt-text (или `alt=""` для декора)

---

## 11) Как тестируем (минимум для релиза 1)

### 11.1 Ручной прогон

- Только клавиатура:
  - пройти booking до подтверждения;
  - открыть/закрыть меню/модалки/аккордеоны;
  - проверить видимость фокуса и порядок.

### 11.2 Скринридер (Windows)

Рекомендуемый минимум:
- NVDA + Chrome/Firefox: пройти ключевые формы и проверить, что элементы названы корректно.

### 11.3 Автоматические проверки (как дополнение)

- Lighthouse Accessibility
- axe DevTools (или интеграция axe в e2e/CI — по мере появления тестовой инфраструктуры)

