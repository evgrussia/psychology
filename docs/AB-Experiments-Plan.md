# План A/B‑экспериментов — «Эмоциональный баланс» (Release 1 → Release 2)

**Версия:** v1.0  
**Дата:** 2026-01-07  
**Основано на:** `docs/PRD.md`, `docs/Tracking-Plan.md`, `docs/Формулы-метрик.md`, `docs/user-flows-cjm.md`, `docs/Content-Guide-UX-Copywriting.md`, `docs/UGC-Moderation-Rules.md`, `docs/Accessibility-A11y-Requirements.md`, `docs/Telegram-Deep-Links-Schema.md`.

---

## 1) Зачем нужен этот документ

Цель — сделать эксперименты **управляемыми и безопасными**: чтобы команда проверяла гипотезы на данных (а не “на ощущениях”), не ломая доверие, приватность и кризисные протоколы.

Этот документ фиксирует:
- **что** можно/нельзя тестировать (в психологии это критично),
- **как** запускать эксперименты (процесс, роли, документация),
- **какими метриками** мерить эффект (KPI + guardrails),
- **как определять длительность** (выборка/окна/минимальные сроки),
- **бэклог гипотез** до релиза и после.

---

## 2) Принципы и ограничения (must‑have)

### 2.1 Safety/этика важнее роста

Эксперименты **не должны**:
- ухудшать доступ к “Экстренной помощи” и кризисному режиму;
- усиливать давление (“срочно/обязательно/иначе”), стыд, директивность;
- провоцировать сбор/передачу чувствительных данных.

Если гипотеза потенциально затрагивает безопасность/этику, она проходит отдельный review (Owner + Product + Legal/Compliance).

### 2.2 Privacy by design (обязательно)

Опираемся на правила из `docs/Tracking-Plan.md`:
- **запрещено** отправлять в аналитику свободный текст (дневники, анкеты, вопрос, ответы квизов);
- в экспериментах можно использовать только агрегаты/ID/теги.

### 2.3 Доступность (WCAG AA) не деградируем

Ни один вариант эксперимента не должен ухудшать требования `docs/Accessibility-A11y-Requirements.md` (клавиатура, фокус, контраст, семантика).

### 2.4 Эксперименты ≠ “внезапные изменения”

Любое изменение в проде, влияющее на ключевые сценарии, должно быть:
- либо **экспериментом** (с флагом, метриками и stop‑правилами),
- либо **явным релизом** (с измерением до/после и планом отката).

---

## 3) Что считаем успехом (метрики)

### 3.1 North Star (на релизе 1)

Проектный “компас” из `docs/PRD.md`:
- рост **подтверждённых записей** и оплат;
- рост **подписки в Telegram** как мягкого продолжения;
- высокое качество “первой пользы” (completion интерактивов, сохранения, возвраты).

### 3.2 Primary metrics по типам экспериментов (используем как “главную”)

Берём определения из `docs/Формулы-метрик.md` и события из `docs/Tracking-Plan.md`:

- **Booking (монетизация)**:
  - `CR booking_start → booking_confirmed (W)`
  - шаговые CR: `booking_start → booking_slot_selected → booking_paid → booking_confirmed`
  - прокси отказа: `show_no_slots`, `payment_failed`
- **Telegram (активация/retention‑канал)**:
  - `CR cta_tg_click → tg_subscribe_confirmed (W)`
  - `CR tg_subscribe_confirmed → tg_onboarding_completed (W)`
- **Интерактивы (активация/ценность)**:
  - completion: `start_quiz → complete_quiz`, `navigator_start → navigator_complete`, `first_step_started → first_step_completed`
  - “следующий шаг”: `complete_* → cta_tg_click` и/или `complete_* → booking_start`
- **Контент (путь к действию)**:
  - `CTA_rate` на странице (см. формулы)
  - `save_resource`, `favorites_add` (если включаем избранное)

### 3.3 Guardrails (метрики‑ограничители)

Эксперимент считается “нельзя выпускать”, если:
- выросла доля `tg_series_stopped` (анти‑спам контроль) или снизился `tg_onboarding_completed`;
- ухудшилась воронка booking (любой шаг) **сильнее порога**, заданного в карточке эксперимента;
- выросли критичные ошибки (например, `payment_failed`) или выросли конфликты (`booking_conflict`);
- выросли инциденты кризисного режима:
  - **мониторим** `crisis_banner_shown` и клики `crisis_help_click` (не как “плохо/хорошо”, а как сигнал риска UX/контента).

---

## 4) Инструментарий экспериментов (минимальные требования)

### 4.1 Единица рандомизации и “липкость”

По умолчанию:
- **рандомизируем по `anonymous_id`** (для гостевых поверхностей) с “липкостью” 30 дней;
- при появлении `user_id` — сохраняем назначение (склейка).

### 4.2 Обязательное событие экспозиции (чтобы A/B был “контролируемым”)

Для каждого эксперимента должен быть фиксирован факт “пользователь увидел вариант”.

**Требование:** отправлять событие `experiment_exposed` при первом показе варианта в рамках сессии/периода.

Рекомендуемые поля:
- `experiment_id` (например `EXP-HP-CTA-01`)
- `variant` (`A|B|C`)
- `surface` (например `home_hero`, `booking_payment`, `quiz_result`)
- `page_path`

> Примечание: это расширение трекинга. Событие не содержит PII и не затрагивает чувствительные данные.

### 4.3 Сегментация (когда нужна)

Разрешённые срезы (если они уже есть в событиях/контексте):
- `entry_point` + UTM (SEO vs Telegram vs direct)
- `topic`
- `timezone`
- `tg_flow` (для Telegram экспериментов)

---

## 5) Процесс запуска эксперимента (операционный)

### 5.1 Роли

- **Owner** (психолог): финальное “да/нет” для изменений тона/этики/границ.
- **Product**: формулирует гипотезы, приоритизацию, пороги успеха/провала.
- **Design/Content**: делает варианты UI/копи по `docs/Content-Guide-UX-Copywriting.md`.
- **Dev**: реализует флаг, корректную экспозицию, не нарушает privacy/a11y.
- **Analytics** (может быть ролью Product): план анализа, дашборд, интерпретация.

### 5.2 Шаблон карточки эксперимента (заполняется на старте)

- **ID/название**:
- **Гипотеза**: *Если мы изменим X, то вырастет Y, потому что Z.*
- **Поверхность**: маршрут/экран (например `/`, `/booking/payment/`, `/start/navigator/`)
- **Аудитория**: новые/все; сегменты; исключения (например кризисные поверхности)
- **Варианты**: A (контроль), B (изменение), (опционально C)
- **Primary metric**: одна
- **Secondary metrics**: 1–3
- **Guardrails**: 2–5 (что не должно ухудшиться)
- **Окно конверсии \(W\)**: 1d/7d/30d (см. `Формулы-метрик.md`)
- **MDE** (минимально значимый эффект): например +10% относительного роста
- **Длительность**: правило (см. раздел 6)
- **Стоп‑правила**: когда выключаем раньше срока
- **QA чеклист**: privacy + a11y + дедупликация событий
- **План решения**: что делаем при win/lose/inconclusive

### 5.3 Стоп‑правила (минимум)

Эксперимент останавливаем и откатываем, если:
- есть инциденты безопасности/этики/комплаенса;
- guardrail провалился (например, `payment_failed` вырос заметно);
- критичные баги UX (пользователь не может пройти booking/интерактив).

---

## 6) Длительность и выборка: как принимать решение без “магии”

### 6.1 Реальность ранней стадии

На старте трафик может быть низким, поэтому:
- не все гипотезы можно честно доказать классическим A/B быстро;
- часть задач решаем **качественными тестами** (прототип) и **smoke‑экспериментами**.

### 6.2 Минимальные сроки (правило “не меньше”)

- **Контент/лендинги/главная**: минимум **7 дней** (перекрыть недельный цикл).
- **Booking**: минимум **14 дней** (эффекты часто “длиннее”).
- **Telegram‑серии / план 7 дней**: минимум **14–21 день** (нужно дождаться взаимодействий).

### 6.3 Окна конверсии \(W\) (фиксируем до запуска)

Рекомендуем по умолчанию:
- `visit → booking_start`: \(W=1d\)
- `booking_start → booking_confirmed`: \(W=7d\)
- `complete_quiz → tg_subscribe_confirmed`: \(W=1d\)
- `tg_subscribe_confirmed → booking_start`: \(W=30d\) (если есть догрев)

### 6.4 Как задаём MDE (минимально значимый эффект)

Практический подход:
- для “простых” UI/копи изменений: **+5–10%** относительного роста primary‑метрики;
- для крупных изменений флоу (booking шаги): **+10–20%**.

### 6.5 Если трафика мало

Используем один из режимов:
- **A/A** (проверка трекинга и рандомизации) 2–7 дней на части трафика;
- **smoke‑эксперимент**: маленький процент трафика (5–20%), цель — проверить направление и отсутствие вреда (guardrails);
- **последовательный подход**: фиксируем минимальный срок, затем смотрим на устойчивость эффекта (не “закрываем” за 1 день).

---

## 7) План экспериментов до релиза (pre‑release)

### 7.1 UX‑валидация прототипа (не A/B в проде, но обязательна)

Используем сценарии из `docs/Wireframes-Figma.md` (раздел 6):
- измеряем “time‑to‑benefit” и ясность доверия/CTA;
- фиксируем места, где пользователь застревает.

Артефакт: короткий отчёт “что сломалось → как исправили”.

### 7.2 A/A для аналитики (перед первыми A/B)

Цель: убедиться, что:
- события не дублируются,
- `experiment_exposed` стреляет корректно,
- метрики стабильны между “одинаковыми” группами.

---

## 8) Бэклог A/B‑гипотез (приоритет: Release 1 и первые 30 дней)

Ниже — стартовый список. Перед запуском каждая гипотеза оформляется карточкой (раздел 5.2).

### 8.1 Главная / хабы / лендинги (активация + доверие)

| ID | Гипотеза | Primary metric | Guardrails | Мин. длительность |
|---|---|---|---|---|
| **EXP-HP-CTA-01** | Если на главной сделать primary‑CTA **Telegram‑план** (а запись — secondary), то вырастет `visit → tg_subscribe_confirmed`, потому что снижается давление первой встречи | `CR visit → tg_subscribe_confirmed (1d)` | `CR visit → booking_start (1d)` не падает >X%; `tg_series_stopped` не растёт >X% | 7–14 дней |
| **EXP-HP-TTB-01** | Если поднять “первый шаг” выше (до блока доверия), то вырастет старт интерактива | `first_step_started` или `start_quiz` на визит | `booking_start` не падает; `faq_opened` не падает сильно | 7 дней |
| **EXP-LND-TRUST-01** | Если на лендинге темы показать trust strip сразу после “что попробовать сейчас”, то вырастет `booking_start` | `CR view_problem_landing → booking_start (7d)` | `cta_tg_click` не падает; рост отказов/времени до клика не критичен | 14 дней |
| **EXP-ART-CTA-01** | Если на статье в блоке “попробовать сейчас” дать CTA “Сохранить в Telegram” (вместо в конце), то вырастет `cta_tg_click` | `CR page_view(article) → cta_tg_click (1d)` | `booking_start` не падает; `tg_series_stopped` не растёт | 7–14 дней |

### 8.2 Интерактивы (completion и “следующий шаг”)

| ID | Гипотеза | Primary metric | Guardrails | Мин. длительность |
|---|---|---|---|---|
| **EXP-QZ-INTRO-01** | Если в интро квиза добавить более явное “~2 минуты + можно остановиться”, то вырастет completion | `start_quiz → complete_quiz` | `crisis_banner_shown` без аномалий; нет роста abandon на 1‑м шаге | 7 дней |
| **EXP-QZ-RES-CTA-01** | Если на результате квиза первичным сделать “План в Telegram” с 1 строкой “зачем”, то вырастет `complete_quiz → tg_subscribe_confirmed` | `CR complete_quiz → tg_subscribe_confirmed (1d)` | `complete_quiz → booking_start` не падает >X%; `tg_series_stopped` не растёт | 14 дней |
| **EXP-NAV-LEN-01** | Если сократить навигатор с 8–10 шагов до 6–7 (без потери смысла), то вырастет completion | `navigator_start → navigator_complete` | `navigator_complete → booking_start` не падает | 14 дней |
| **EXP-PRP-BOOK-01** | Если после “Подготовки к консультации” показать “что будет дальше на записи” перед кнопкой, то вырастет `consultation_prep_complete → booking_start` | `CR consultation_prep_complete → booking_start (7d)` | `consultation_prep_exported` не падает (не “вытесняем” тихий путь) | 14 дней |

### 8.3 Booking / оплата / “нет слотов” (монетизация)

| ID | Гипотеза | Primary metric | Guardrails | Мин. длительность |
|---|---|---|---|---|
| **EXP-BKG-SUMMARY-01** | Если на шаге оплаты сделать более ясный summary (“что вы получаете + правила”), то вырастет `booking_slot_selected → booking_paid` | `CR booking_slot_selected → booking_paid (1d/7d)` | `payment_failed` не растёт >X% | 14 дней |
| **EXP-BKG-NOSLOTS-01** | Если в “нет слотов” первым вариантом дать Telegram‑консьержа (вместо waitlist), то вырастет доля “спасённых” лидов | `tg_subscribe_confirmed` с `tg_flow=concierge` **или** `waitlist_submitted` (по выбранной стратегии) | нет роста жалоб/stop в TG; качество лидов не ухудшается | 14–21 день |
| **EXP-PAY-ERR-01** | Если на ошибке оплаты добавить “повторить” + альтернативу “написать”, то вырастет recovery в оплату | `CR payment_failed → booking_paid (7d)` | нет роста повторных ошибок/дедуп событий | 14 дней |

### 8.4 Telegram‑онбординг и серии (activation/retention)

| ID | Гипотеза | Primary metric | Guardrails | Мин. длительность |
|---|---|---|---|---|
| **EXP-TG-ONB-01** | Если в онбординге сначала спросить частоту, а потом тему, то вырастет `tg_onboarding_completed` | `CR tg_subscribe_confirmed → tg_onboarding_completed (1d)` | `tg_series_stopped` не растёт >X% | 14 дней |
| **EXP-TG-REM-01** | Если напоминание 24h по “сохранить ресурс” сделать opt‑in (вместо default), то снизится stop rate без потери engagement | `StopRate` по `tg_flow=save_resource` | `tg_interaction` не падает >X% | 21 день |

---

## 9) Эксперименты после 30 дней (условные триггеры запуска)

Берём пороги из `docs/Competitive-Research-Implementation-Report.md` / `docs/Roadmap-P1-Activities.md`:

- Если **Retention D7 < 30%**:
  - запуск P1‑01 “Письмо себе через 7 дней” (как эксперимент по удержанию),
  - тест “тихой геймификации без стриков” (P1‑04).
- Если **контента > 20 элементов**:
  - A/B на навигации “подборки” (`/curated/`) и словаря (`/glossary/`) — как улучшение поиска “первого шага”.

---

## 10) Где храним результаты (обязательная документация)

Для каждого эксперимента создаём короткий отчёт (можно в `docs/generated/testing/` или отдельной папке экспериментов):
- **контекст + гипотеза**
- **даты + аудитория + варианты**
- **метрики (primary/guardrails)**
- **решение**: win/lose/inconclusive
- **следующий шаг**: выкатываем/итерируем/откатываем

Важно: “inconclusive” — нормальный исход. Цель экспериментов — **снижать неопределённость**, а не “всегда выигрывать”.

