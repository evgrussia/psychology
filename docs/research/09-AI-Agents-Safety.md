# 09 — AI/LLM‑агенты (LangChain): сценарии, безопасность, ограничения, human‑in‑the‑loop

## 0) Рамка: что AI делает и чего не делает
AI в этом проекте — **не терапевт**. Его роль:
- навигация по порталу (“что мне сейчас попробовать”),
- сервис записи (консьерж),
- помощь психологу с черновиками контента,
- аналитика тем (агрегированно, без чувствительных данных),
- подготовка “домашек/памяток” — только как черновик, подтверждаемый психологом.

AI **не делает**:
- диагностику,
- лечение,
- интерпретацию клинических состояний,
- работу с кризисом как единственный канал помощи.

## 1) Сценарий 1: Агент‑навигация «Подобрать следующий шаг»
### 1.1 Вход и выход
**Вход:** 5–7 мягких вопросов.
**Выход:** 1–3 рекомендации:
- раздел сайта (лендинг проблемы),
- конкретное упражнение/ресурс,
- статья,
- вариант услуги/запись.

### 1.2 Мягкие вопросы (пример)
- «Что сейчас больше всего беспокоит?»
- «Это ощущается скорее остро “прямо сейчас” или фоном?»
- «Чего хочется: облегчения, ясности или решения?»
- «Есть ли что-то, что уже немного помогало?»
- «Сколько времени у вас есть на первый шаг: 2 минуты / 10 минут / больше?»

### 1.3 Политика ответа
- не использовать “диагноз”
- давать 1 маленький шаг + 1 запасной вариант
- всегда предлагать “остановиться/пауза”

### 1.4 Кризис‑фильтр
При признаках кризиса:
- показывать экстренный блок (см. `01-*`)
- ограничить ответ общими действиями безопасности

## 2) Сценарий 2: Агент‑консьерж записи
### 2.1 Функции
- объяснить услуги и разницу
- собрать предпочтения (онлайн/офлайн, время, цель)
- предложить слоты (через интеграцию)
- отправить подтверждение/напоминания

### 2.2 Ограничения
- не обсуждать терапевтический контент
- не хранить чувствительные подробности
- при сомнениях — перевод на человека

## 3) Сценарий 3: Агент‑контент‑редактор (для психолога)
### 3.1 Вход
- тезисы психолога
- список вопросов аудитории
- опубликованная статья (как база)

### 3.2 Выход
- 3 версии TG‑поста (короткий/длинный/Q&A)
- черновик статьи по шаблону из `03-*`
- обязательные дисклеймеры и тон

### 3.3 Human‑in‑the‑loop
Правило: **всё, что уходит наружу, утверждает психолог**.

## 4) Сценарий 4: Агент‑аналитик тем аудитории
### 4.1 Источники (безопасные)
- агрегированные результаты квизов (уровни, без ответов)
- популярные темы (по кликам/поиску/тегам)
- анонимные “категории” вопросов (без текста, если риск)

### 4.2 Выход
- темы недели
- контент‑план (7–14 дней)
- “какие CTA лучше конвертят” (на основе событий)

## 5) Сценарий 5: «Материалы после сессии»
### 5.1 Поток
- психолог делает заметки в закрытом интерфейсе
- агент формирует черновик памятки/домашки
- психолог проверяет/правит
- отправка клиенту через ЛК/email (не обязательно через Telegram)

### 5.2 Ограничения приватности
- материалы содержат чувствительные данные → высокий уровень защиты
- запрет на использование этих данных для обучения модели

## 6) Безопасная архитектура (концептуально)
### 6.1 Рекомендуемые слои
1) **UI** (чат‑виджет/страница)
2) **Policy & Guardrails**
   - классификатор “кризис/не кризис”
   - фильтр PII
   - правила отказа/перенаправления
3) **Retrieval (RAG)**
   - только внутренние документы/страницы/ресурсы
4) **LLM**
5) **Post‑processing**
   - вставка дисклеймеров
   - форматирование, кнопки

### 6.2 Что хранить в логах
- событийную аналитику (тип интента, без текста)
- ошибки/тайминги

Что не хранить:
- подробные описания состояния пользователя
- “сырые” сообщения (если нет строгой политики и согласий)

## 7) Политика отказов (refusal) и перенаправления
Случаи:
- просьба поставить диагноз
- просьба “как принимать лекарства”
- кризис (самоповреждение, насилие)
- несовершеннолетние (если ограничение)

Шаблон отказа:
> Я не могу помогать с медицинскими рекомендациями или диагностикой. Но могу предложить безопасный первый шаг и подсказать, куда обратиться за профессиональной помощью.

## 8) Тестирование и оценка качества (AI)
### 8.1 Набор тест‑кейсов (минимум)
- пользователь в тревоге → получает упражнение + безопасный тон
- пользователь просит диагноз → корректный отказ
- кризисный запрос → экстренный блок
- запись → корректные слоты/правила

### 8.2 Критерии
- безопасность (нет опасных советов)
- тон (эмпатия, без давления)
- точность навигации (релевантные ресурсы)
- отсутствие утечек данных

