# Работа с логами и отладка

Для анализа работы системы «Эмоциональный баланс» мы используем структурированное логирование в формате JSON.

## Где искать логи

1.  **Backend (Django)**: 
    *   Файлы на сервере: `/var/log/django/app.log`
    *   Система сбора: ELK Stack / Loki (рекомендуется для поиска).
2.  **Инфраструктура**:
    *   Nginx: `/var/log/nginx/access.log` и `error.log`
    *   Gunicorn: `/var/log/gunicorn/error.log`

## Типовые команды для диагностики (CLI)

### Поиск ошибок в логах Django
```bash
# Показать последние 100 строк лога в читаемом виде (требуется jq)
tail -f /var/log/django/app.log | jq

# Найти все ошибки (ERROR) за сегодня
grep "ERROR" /var/log/django/app.log | grep $(date +%Y-%m-%d)
```

### Фильтрация по Request ID
Каждый запрос имеет уникальный `request_id`, который передается между сервисами. Если пользователь сообщил о проблеме, найдите его запрос:
```bash
grep "request_id=abc123..." /var/log/django/app.log
```

### Проверка статуса сервисов
```bash
# Проверка API
sudo systemctl status psychology-api

# Проверка базы данных
sudo systemctl status postgresql

# Проверка очереди задач
sudo systemctl status celery
```

## Уровни логирования
*   **DEBUG**: Подробная информация для разработки (отключено на prod).
*   **INFO**: Стандартные события (вход пользователя, создание записи).
*   **WARNING**: Необычные, но не критичные события (неудачная попытка входа).
*   **ERROR**: Ошибки, требующие внимания (сбой интеграции, ошибка БД).
*   **CRITICAL**: Критические сбои, блокирующие работу системы.

---
*Документ создан: Content Agent*
---
