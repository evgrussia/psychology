# Чеклист деплоя Psychology Platform на Dev Server

## Перед деплоем

### 1. Подготовка локальной машины
- [ ] Есть доступ к серверу по SSH (root@213.159.67.199)
- [ ] Есть доступ к Git репозиторию
- [ ] Настроен SSH ключ для GitHub (если репозиторий приватный)
- [ ] Создан email для SSL сертификатов

### 2. DNS настройки
- [ ] Создана A-запись: `@` → `213.159.67.199`
- [ ] Создана A-запись: `www` → `213.159.67.199`
- [ ] Создана A-запись: `admin` → `213.159.67.199`
- [ ] Создана A-запись: `api` → `213.159.67.199`
- [ ] DNS записи распространились (проверено через `nslookup`)

### 3. Переменные окружения
- [ ] Сгенерирован пароль для БД
- [ ] Сгенерирован пароль для Redis
- [ ] Сгенерирован JWT_SECRET (64+ символов)
- [ ] Сгенерирован SESSION_SECRET (64+ символов)
- [ ] Записаны все пароли в безопасное место

## Настройка сервера

### 4. Первоначальная настройка
- [ ] Подключение к серверу: `ssh root@213.159.67.199`
- [ ] Загружен скрипт setup-server.sh на сервер
- [ ] Запущен скрипт: `bash setup-server.sh`
- [ ] Скрипт выполнен без ошибок
- [ ] Проверен Docker: `docker --version`
- [ ] Проверен файрвол: `ufw status`

### 5. SSL сертификаты
- [ ] Запущен Certbot для получения сертификатов
- [ ] Сертификаты получены успешно
- [ ] Проверены файлы в `/etc/letsencrypt/live/balance-space.ru/`
- [ ] Созданы символические ссылки в `/var/www/psychology/nginx/ssl/`

### 6. Клонирование проекта
- [ ] Переключение на пользователя deploy: `su - deploy`
- [ ] Перейти в директорию: `cd /var/www/psychology`
- [ ] Склонирован репозиторий
- [ ] Проверена ветка: `git branch` (должна быть main)

### 7. Настройка окружения
- [ ] Скопирован файл: `cp env.prod.example .env.prod`
- [ ] Отредактирован `.env.prod`
- [ ] Вставлены все пароли и секреты
- [ ] Проверены все URL (должны соответствовать домену)
- [ ] Сохранен файл

### 8. Подготовка к деплою
- [ ] Сделан скрипт исполняемым: `chmod +x scripts/deploy.sh`
- [ ] Проверена структура директорий
- [ ] Создана директория для логов: `mkdir -p nginx/logs`
- [ ] Создана директория для бэкапов: `sudo mkdir -p /var/backups/psychology`

## Деплой

### 9. Запуск деплоя
- [ ] Запущен скрипт деплоя: `./scripts/deploy.sh deploy`
- [ ] Дождаться завершения (10-15 минут)
- [ ] Проверить, что нет ошибок
- [ ] Все контейнеры запущены: `docker ps`

### 10. Проверка контейнеров
- [ ] `psychology-prod-db` - работает
- [ ] `psychology-prod-redis` - работает
- [ ] `psychology-prod-api` - работает
- [ ] `psychology-prod-web` - работает
- [ ] `psychology-prod-admin` - работает
- [ ] `psychology-prod-nginx` - работает

## Проверка работоспособности

### 11. Тестирование API
- [ ] `curl http://localhost/api/health` - возвращает 200
- [ ] `curl http://localhost/api/version` - возвращает версию
- [ ] `curl https://balance-space.ru/api/health` - работает через HTTPS

### 12. Тестирование Frontend
- [ ] Открыть https://balance-space.ru в браузере
- [ ] Сайт загружается без ошибок
- [ ] SSL сертификат валидный (зеленый замок)
- [ ] Нет ошибок в консоли браузера

### 13. Тестирование Admin
- [ ] Открыть https://admin.balance-space.ru в браузере
- [ ] Admin панель загружается
- [ ] SSL сертификат валидный
- [ ] Нет ошибок в консоли

### 14. Проверка логов
- [ ] `docker logs psychology-prod-api` - нет критических ошибок
- [ ] `docker logs psychology-prod-web` - нет критических ошибок
- [ ] `docker logs psychology-prod-nginx` - нет ошибок 500/502
- [ ] `docker logs psychology-prod-db` - БД работает корректно

### 15. Проверка базы данных
- [ ] Подключение к БД работает: `docker exec -it psychology-prod-db psql -U psychology_user -d psychology_prod`
- [ ] Таблицы созданы: `\dt`
- [ ] Миграции применены успешно
- [ ] Можно выйти из psql: `\q`

## Постдеплой настройки

### 16. Настройка резервного копирования
- [ ] Протестировано создание бэкапа: `./scripts/deploy.sh backup`
- [ ] Бэкап создан в `/var/backups/psychology/`
- [ ] Настроен cron для автоматических бэкапов
- [ ] Протестирован cron: `crontab -l`

### 17. Мониторинг
- [ ] Настроен мониторинг ресурсов: `docker stats`
- [ ] Проверено использование диска: `df -h`
- [ ] Настроены алиасы в `.bashrc` (опционально)
- [ ] Протестированы команды из `docs/COMMANDS.md`

### 18. Документация
- [ ] Сохранены пароли в безопасном месте
- [ ] Документирован процесс деплоя
- [ ] Записаны особенности конфигурации
- [ ] Команда ознакомлена с процессом

## Финальная проверка

### 19. Функциональное тестирование
- [ ] API отвечает на запросы
- [ ] Frontend отображается корректно
- [ ] Admin панель работает
- [ ] Роутинг работает корректно
- [ ] Статические файлы загружаются
- [ ] HTTPS работает на всех доменах

### 20. Performance тестирование
- [ ] Сайт загружается быстро (< 3 сек)
- [ ] API отвечает быстро (< 500ms)
- [ ] Нет проблем с памятью
- [ ] CPU загрузка в норме

### 21. Безопасность
- [ ] Файрвол настроен правильно
- [ ] SSL сертификаты валидны
- [ ] Все пароли сложные и уникальные
- [ ] `.env.prod` не в Git
- [ ] SSH доступ только по ключу (опционально)

### 22. Резервное копирование и восстановление
- [ ] Протестировано создание бэкапа
- [ ] Протестировано восстановление из бэкапа (на тестовых данных)
- [ ] Бэкапы сохраняются регулярно
- [ ] Есть план восстановления при сбое

## Готово к production

### 23. Финальные шаги
- [ ] Все пункты чеклиста выполнены
- [ ] Нет критических проблем
- [ ] Команда проинформирована
- [ ] Документация актуальна
- [ ] Мониторинг настроен
- [ ] План действий при инцидентах готов

---

## Контакты для эскалации

- **DevOps**: [Ваше имя / контакты]
- **Backend**: [Контакты]
- **Frontend**: [Контакты]

---

## Дата деплоя

**Дата**: _______________  
**Кто выполнял**: _______________  
**Версия**: _______________  
**Время деплоя**: _______________  
**Проблемы**: _______________

---

**✅ ВСЕ ПУНКТЫ ВЫПОЛНЕНЫ - ДЕПЛОЙ УСПЕШЕН!**
