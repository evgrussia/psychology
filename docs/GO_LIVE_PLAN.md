# Go Live Plan — «Эмоциональный баланс»

Детальный план проведения деплоя в Production.

## 1. Фаза 1: Подготовка (День -1)
- [ ] Финальный прогон Smoke Tests в Staging.
- [ ] Проверка актуальности бэкапов.
- [ ] Тестовое восстановление БД из вчерашнего бэкапа.
- [ ] Уведомление стейкхолдеров о предстоящем деплое.
- [ ] Проверка всех API ключей и доступов к внешним сервисам.

## 2. Фаза 2: Go Live (День 0)
**Окно обслуживания:** 02:00 - 04:00 (MSK)

### Шаг 1: Изоляция и Бэкап (02:00 - 02:15)
- [ ] Включить Maintenance Mode на Load Balancer.
- [ ] Создать финальный бэкап Production БД: `pg_dump ... > pre_golive.sql`.
- [ ] Проверить целостность созданного бэкапа.

### Шаг 2: Деплой Backend (02:15 - 02:45)
- [ ] `git pull origin main` на сервере.
- [ ] Обновить виртуальное окружение: `pip install -r requirements.txt`.
- [ ] Применить миграции: `python manage.py migrate`.
- [ ] Собрать статику: `python manage.py collectstatic`.
- [ ] Перезапустить сервисы: `sudo systemctl restart psychology-api`.

### Шаг 3: DNS и SSL (02:45 - 03:15)
- [ ] Обновить DNS записи (если требуется).
- [ ] Проверить SSL сертификат (Let's Encrypt).

### Шаг 4: Верификация (03:15 - 04:00)
- [ ] Запустить автоматизированные Smoke Tests: `pytest tests/smoke/test_production.py`.
- [ ] Провести ручной обход основных сценариев (G1-G4).
- [ ] Проверить поступление метрик в Prometheus/Grafana.
- [ ] Проверить запись логов в ELK/Loki.

## 3. Фаза 3: Сопровождение (День +1)
- [ ] Мониторинг ошибок (Error Rate) — реакция в течение 5 минут.
- [ ] Проверка SLO по латентности и доступности.
- [ ] Мониторинг Telegram-бота и уведомлений.
- [ ] Сбор первой обратной связи от пользователей.

## 4. План отката (Rollback Plan)
Если в течение 1 часа после запуска обнаружена критическая ошибка (SEV-1), не подлежащая быстрому исправлению:
1. Остановить текущие сервисы.
2. Откатить код к предыдущему тегу: `git checkout vX.X.X`.
3. Откатить базу данных из бэкапа `pre_golive.sql`.
4. Перезапустить сервисы.
5. Провести Smoke Tests для подтверждения возврата в рабочее состояние.
6. Сообщить команде и стейкхолдерам.

---
*Документ создан: Orchestrator Agent*
---
