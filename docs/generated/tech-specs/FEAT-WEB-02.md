# Техническая спецификация фичи (Tech Spec)

**Проект:** «Эмоциональный баланс»  
**Версия спеки:** v0.1 (draft)  
**Автор:** Cursor Agent  
**Дата:** 2026-01-07  
**Статус:** draft  

**Feature ID:** `FEAT-WEB-02`  
**Epic:** `EPIC-01`  
**Приоритет:** P0  
**Трекер:** —  

**Оценка реализации агентом Cursor:** ~70k токенов (≤ 270k)

---

## 1) Summary (коротко)

### 1.1 Что делаем
Делаем страницы доверия: `/about/` и `/how-it-works/` (или секции внутри about) + FAQ + “границы/этика/конфиденциальность”, чтобы покрыть возражения (стыд, давление, конфиденциальность, “подойдёт ли”).

### 1.2 Почему сейчас (контекст / метрики / риск)
- **Сигнал/боль:** PRD фиксирует топ‑возражения, которые должны быть закрыты UX/контентом.
- **Ожидаемый эффект:** рост `booking_start` и снижение drop‑off перед оплатой.
- **Если не сделать:** недоверие и низкая конверсия в запись.

### 1.3 Ссылки на первоисточники
- PRD: `docs/PRD.md` (FR-TRUST-1..3)
- IA: `docs/information-architecture.md` (`/about/`, `/how-it-works/`)
- Content guide: `docs/Content-Guide-UX-Copywriting.md`
- Tracking: `docs/Tracking-Plan.md` (trust_block_viewed, faq_opened)

---

## 2) Goals / Non-goals

### 2.1 Goals (что обязательно)
- **G1:** Страница “О психологе” содержит: подход, образование, этика/границы, кому подойдёт/не подойдёт, конфиденциальность, FAQ.
- **G2:** Страница “Как проходит консультация”: шаги процесса, правила, ожидания, подготовка, ссылки на запись.
- **G3:** Встроенная перелинковка на услуги/запись/Telegram (не агрессивно).

### 2.2 Non-goals (что осознанно НЕ делаем)
- **NG1:** Публикация отзывов как UGC‑модуль (это отдельная линия и требует согласий).

---

## 3) Scope (границы и сценарии)

### 3.1 In-scope (конкретные сценарии)
- **US-1:** Пользователь читает “как проходит”, раскрывает FAQ, нажимает “Запись”.
- **US-2:** Пользователь понимает рамки (“не экстренная помощь”, “не диагноз”, 18+).

### 3.2 Out-of-scope
- Динамические персонализированные блоки.

### 3.3 Acceptance criteria (AC)
- [ ] AC-1 Страницы доступны из header/footer и ключевых CTA на сайте.
- [ ] AC-2 На страницах есть trust события (view/open) в трекинге.
- [ ] AC-3 Контент редактируется через CMS (`FEAT-CNT-01`) или как служебные страницы.

### 3.4 Негативные сценарии (обязательные)
- **NS-1:** Контент страницы отсутствует в CMS → показываем fallback (черновик/заглушка) и 404 не отдаём.

---

## 4) UX / UI (что увидит пользователь)

### 4.1 Изменения экранов/страниц
- **Маршруты/страницы:** `/about/`, `/how-it-works/`.
- **Состояния UI:** loading/empty/error.
- **Копирайт/тон:** бережно, без директивности.

### 4.2 A11y (минимум)
- [ ] Семантика FAQ (button + aria-expanded).
- [ ] Таблица/списки читаемы скринридером.

---

## 5) Архитектура и ответственность слоёв (Clean Architecture)

### 5.1 Компоненты/модули
- **Presentation:** страницы + компоненты (TrustSection, FAQAccordion, EducationBlock, BoundariesBlock).
- **Application:** `GetPageContentUseCase` (служебные страницы).
- **Domain:** `ContentItem` (`content_type=page`).
- **Infrastructure:** content repo.

### 5.2 Основные use cases (сигнатуры)
- `GetPageBySlugUseCase.execute({ slug }): { title, body_markdown, blocks }`

### 5.3 Доменные события (если нужны)
Не нужны.

---

## 6) Модель данных (БД) и миграции
Используем `content_items` (`content_type=page`) из `FEAT-CNT-01`.

---

## 7) API / Контракты (если применимо)

### 7.1 Public API (web)
| Endpoint | Method | Auth | Request | Response | Ошибки |
|---|---:|---|---|---|---|
| `/api/public/pages/{slug}` | GET | public | — | `200 {page}` | 404/500 |

---

## 8) Tracking / Analytics (по `docs/Tracking-Plan.md`)

### 8.1 События (таблица)
| Event name | Source | Когда срабатывает | Props (P0-only) | Запреты |
|---|---|---|---|---|
| `trust_block_viewed` | web | пользователь видит блок | `trust_block`, `page_path` | — |
| `faq_opened` | web | раскрыли вопрос | `faq_id`, `page_path` | — |
| `cta_click` | web | клик “Запись/Telegram” | `cta_id`, `cta_target` | — |

### 8.2 Воронка / метрики успеха
- uplift `booking_start` для пользователей, которые просмотрели trust‑страницы.

---

## 9) Security / Privacy / Compliance

### 9.1 Privacy by design (обязательные пункты)
- [ ] В событиях нет PII/текста.

### 9.2 RBAC и аудит
Не применимо.

### 9.3 Кризисный режим (если применимо)
Ссылка “экстренная помощь” видима и доступна.

---

## 10) Надёжность, производительность, деградации

### 10.1 SLA/SLO (если критично)
SSG/SSR для стабильной скорости.

### 10.3 Деградации (fallback)
Если CMS недоступна — отдаём кэш/статическую версию.

---

## 11) Rollout plan
- `trust_pages_v1_enabled` (stage → prod)

---

## 12) Test plan

### 12.3 E2E (критические happy paths)
- `/about/` → клик “Запись” → `/booking/`
- `/how-it-works/` → раскрыть FAQ → событие `faq_opened`

### 12.5 A11y smoke
- [ ] клавиатура по FAQ, фокус

---

## 13) Open questions / решения

### 13.1 Вопросы
- [ ] Делать ли `/how-it-works/` отдельной страницей или секцией `/about/` (IA допускает оба).

### 13.2 Decision log (что и почему решили)
- **2026-01-07:** контент страниц доверия хранится в CMS как `page`, чтобы править без разработчика.

