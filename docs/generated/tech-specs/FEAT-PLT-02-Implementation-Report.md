# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FEAT-PLT-02

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2026-01-13  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-13  
**–ü—Ä–æ–≤–µ—Ä—è–µ–º–∞—è —Ç–µ—Ö—Å–ø–µ–∫–∞:** `docs/generated/tech-specs/FEAT-PLT-02.md`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

---

## 1. Executive Summary

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ö—Å–ø–µ–∫–∏ FEAT-PLT-02 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ **100%**. –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î (AC-4, 12.2)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `trigger_flags` –Ω–∞ JSONB
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω CHECK constraint –¥–ª—è `curated_items` XOR
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** 100%

**‚úÖ –í—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 2026-01-13):**
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ö–µ–º—ã –ë–î (`test/database.spec.ts`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã (appointments, availability_slots, payments)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `trigger_flags` –Ω–∞ JSONB (–º–∞—Å—Å–∏–≤ enum –∑–Ω–∞—á–µ–Ω–∏–π)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω CHECK constraint –¥–ª—è `curated_items` XOR —Å–≤—è–∑–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º (`docs/database-migrations-guide.md`)

---

## 2. –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —Ç–µ—Ö—Å–ø–µ–∫–∏

### ‚úÖ 2.1 Goals (G1-G5)

#### G1: –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ Postgres —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `docs/–ú–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö.md`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã:**

1. **Identity & Access** ‚úÖ
   - ‚úÖ `users` - –≤—Å–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è email/phone/telegram_user_id
   - ‚úÖ `roles` - –∫–æ–¥ –∏ scope
   - ‚úÖ `user_roles` - —Å–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞
   - ‚úÖ `consents` - –≤—Å–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è version –∏ source

2. **Content** ‚úÖ
   - ‚úÖ `content_items` - –≤—Å–µ –ø–æ–ª—è, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (content_type, slug)
   - ‚úÖ `topics` - –∫–æ–¥ –∫–∞–∫ PK
   - ‚úÖ `tags` - slug —É–Ω–∏–∫–∞–ª–µ–Ω
   - ‚úÖ `content_item_topics`, `content_item_tags` - —Å–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
   - ‚úÖ `media_assets` - –≤—Å–µ –ø–æ–ª—è, object_key —É–Ω–∏–∫–∞–ª–µ–Ω
   - ‚úÖ `content_media` - —Å–≤—è–∑—å —Å usage
   - ‚úÖ `curated_collections` - slug —É–Ω–∏–∫–∞–ª–µ–Ω
   - ‚úÖ `curated_items` - XOR —Å–≤—è–∑—å (content_item_id –∏–ª–∏ interactive_definition_id)
   - ‚úÖ `glossary_terms` - slug —É–Ω–∏–∫–∞–ª–µ–Ω
   - ‚úÖ `glossary_term_synonyms` - —Å–∏–Ω–æ–Ω–∏–º—ã
   - ‚úÖ `glossary_term_links` - —Å–≤—è–∑–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

3. **Interactive** ‚úÖ
   - ‚úÖ `interactive_definitions` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (interactive_type, slug)
   - ‚úÖ `interactive_runs` - –∞–≥—Ä–µ–≥–∞—Ç—ã –±–µ–∑ —Å—ã—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, user_id –∏–ª–∏ anonymous_id

4. **Booking & Payments** ‚úÖ
   - ‚úÖ `services` - slug —É–Ω–∏–∫–∞–ª–µ–Ω
   - ‚úÖ `availability_slots` - –≤—Å–µ –ø–æ–ª—è, –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - ‚úÖ `appointments` - –≤—Å–µ –ø–æ–ª—è, —Å–≤—è–∑—å —Å lead_id
   - ‚úÖ `payments` - provider_payment_id —É–Ω–∏–∫–∞–ª–µ–Ω (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
   - ‚úÖ `intake_forms` - payload_encrypted (P2)
   - ‚úÖ `waitlist_requests` - contact_value_encrypted (P1)

5. **Client Cabinet** ‚úÖ
   - ‚úÖ `diary_entries` - payload_encrypted (P2)
   - ‚úÖ `data_export_requests` - –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã

6. **Telegram & Deep Links** ‚úÖ
   - ‚úÖ `deep_links` - deep_link_id –∫–∞–∫ PK, expires_at –¥–ª—è TTL

7. **CRM & Analytics** ‚úÖ
   - ‚úÖ `leads` - utm –∫–∞–∫ JSONB
   - ‚úÖ `lead_identities` - email_encrypted, phone_encrypted (P1)
   - ‚úÖ `lead_timeline_events` - properties –∫–∞–∫ JSONB (P0-only)

8. **UGC Moderation** ‚úÖ
   - ‚úÖ `anonymous_questions` - question_text_encrypted (P2), trigger_flags
   - ‚úÖ `question_answers` - answer_text_encrypted (P2)
   - ‚úÖ `ugc_moderation_actions` - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
   - ‚úÖ `reviews` - review_text_encrypted (P2)
   - ‚úÖ `review_publication_consents` - —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é

9. **Admin & Audit** ‚úÖ
   - ‚úÖ `audit_log_entries` - –≤—Å–µ –ø–æ–ª—è –¥–ª—è –∞—É–¥–∏—Ç–∞
   - ‚úÖ `message_templates` - –∫–∞–Ω–∞–ª—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - ‚úÖ `message_template_versions` - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–º–µ—á–∞–Ω–∏—è:**
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** `trigger_flags` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `Json?` (JSONB) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ enum –∑–Ω–∞—á–µ–Ω–∏–π. –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: `20260113120000_add_indexes_and_constraints`.

#### G2: –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã –≤ CI, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤ prod
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- ‚úÖ Prisma –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (`migrate:dev`, `migrate:deploy`, `migrate:status`)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã:
  - `.github/workflows/deploy-stage.yml` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
  - `.github/workflows/deploy-prod.yml` - —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- ‚úÖ Docker Compose –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ README —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î

**–§–∞–π–ª—ã:**
- `apps/api/prisma/schema.prisma`
- `apps/api/prisma/migrations/20260113110201_init_release_1/migration.sql`
- `apps/api/prisma/migrations/20260113110522_add_performance_indexes/migration.sql`
- `.github/workflows/deploy-stage.yml`
- `.github/workflows/deploy-prod.yml`
- `docker-compose.yml`

#### G3: P2 –ø–æ–ª—è —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ "–≤ –ø–æ–∫–æ–µ"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞)**

–í—Å–µ P2 –ø–æ–ª—è –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `*_encrypted`:
- ‚úÖ `intake_forms.payload_encrypted`
- ‚úÖ `diary_entries.payload_encrypted`
- ‚úÖ `anonymous_questions.question_text_encrypted`
- ‚úÖ `question_answers.answer_text_encrypted`
- ‚úÖ `reviews.review_text_encrypted`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–∞–º–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (FEAT-SEC-02), –ë–î –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

#### G4: –ò–Ω–¥–µ–∫—Å—ã/—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
- ‚úÖ `content_items (content_type, slug)` UNIQUE
- ‚úÖ `services.slug` UNIQUE
- ‚úÖ `glossary_terms.slug` UNIQUE
- ‚úÖ `curated_collections.slug` UNIQUE
- ‚úÖ `payments.provider_payment_id` UNIQUE
- ‚úÖ `deep_links.deep_link_id` PK (—É–Ω–∏–∫–∞–ª–µ–Ω)
- ‚úÖ `appointments (start_at_utc, end_at_utc, status)` –∏–Ω–¥–µ–∫—Å
- ‚úÖ `availability_slots (start_at_utc, end_at_utc, status)` –∏–Ω–¥–µ–∫—Å
- ‚úÖ `lead_timeline_events (lead_id, occurred_at)` –∏–Ω–¥–µ–∫—Å
- ‚úÖ `anonymous_questions (status, submitted_at)` –∏–Ω–¥–µ–∫—Å
- ‚úÖ `content_items (status, content_type, slug)` –∏–Ω–¥–µ–∫—Å
- ‚úÖ `deep_links.created_at` –∏–Ω–¥–µ–∫—Å (–¥–ª—è TTL –æ—á–∏—Å—Ç–∫–∏)
- ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–û:** `appointments.start_at_utc` –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–û:** `appointments.status` –∏–Ω–¥–µ–∫—Å (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É)
- ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–û:** `availability_slots.source` –∏–Ω–¥–µ–∫—Å (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É)
- ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–û:** `payments (provider, provider_payment_id)` —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å

**–ó–∞–º–µ—á–∞–Ω–∏–µ –ø–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚ö†Ô∏è –í –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —É–∫–∞–∑–∞–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (FR-BKG-7), –Ω–æ –≤ —Å—Ö–µ–º–µ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ UNIQUE constraint –Ω–∞ `(start_at_utc, end_at_utc)` –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏.

#### G5: –ë–∞–∑–æ–≤—ã–µ seed-–¥–∞–Ω–Ω—ã–µ (topics, roles)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- ‚úÖ Seed —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: `apps/api/prisma/seed.ts`
- ‚úÖ –†–æ–ª–∏: `owner`, `assistant`, `editor`, `client` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ scope
- ‚úÖ –¢–µ–º—ã: `anxiety`, `burnout`, `relationships`, `boundaries`, `selfesteem`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `upsert` –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `apps/api/prisma/seed.ts`

---

### ‚úÖ 3. Acceptance Criteria (AC-1 - AC-4)

#### AC-1: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã/enum/constraints –∏–∑ `docs/–ú–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö.md` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (98%)**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**

1. **Enums** ‚úÖ
   - –í—Å–µ enum —Ç–∏–ø—ã –∏–∑ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ Prisma schema
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

2. **–¢–∞–±–ª–∏—Ü—ã** ‚úÖ
   - –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è Release 1 –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
   - –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ foreign keys

3. **Constraints** ‚úÖ
   - ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è slug –ø–æ–ª–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
   - ‚úÖ Foreign keys –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - ‚úÖ **–î–û–ë–ê–í–õ–ï–ù CHECK constraint** –¥–ª—è XOR –≤ `curated_items` (—á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é `20260113120000_add_indexes_and_constraints`)

**–ó–∞–º–µ—á–∞–Ω–∏—è:**
- ‚ö†Ô∏è `trigger_flags` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º enum, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–æ–π
- ‚ö†Ô∏è –ù–µ—Ç —è–≤–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è PII –≤ `lead_timeline_events.properties`

#### AC-2: –ï—Å—Ç—å seed: —Ä–æ–ª–∏ –∏ —Ç–µ–º—ã
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

–°–º. —Ä–∞–∑–¥–µ–ª G5 –≤—ã—à–µ.

#### AC-3: –ë–∞–∑–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (85%)**

–°–º. —Ä–∞–∑–¥–µ–ª G4 –≤—ã—à–µ. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –µ—Å—Ç—å, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

#### AC-4: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ –ø—É—Å—Ç–æ–π –ë–î –∏ –Ω–∞ stage/prod –±–µ–∑ —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ CI/CD
- ‚úÖ Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–°–û–ó–î–ê–ù–´ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (`test/database.spec.ts`), –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
  - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ –ø—É—Å—Ç–æ–π –ë–î
  - –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π
  - Smoke –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ–Ω—Ç–µ–Ω—Ç, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤, –∑–∞–ø–∏—Å—å+–ø–ª–∞—Ç–µ–∂)
  - Privacy by Design –ø—Ä–æ–≤–µ—Ä–∫–∏
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤

---

### ‚úÖ 4. Privacy by Design (9.1)

#### P2 –ø–æ–ª—è –≤—ã–¥–µ–ª–µ–Ω—ã –∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ encrypted payload
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

–í—Å–µ P2 –ø–æ–ª—è –∏–º–µ—é—Ç —Å—É—Ñ—Ñ–∏–∫—Å `_encrypted`:
- `intake_forms.payload_encrypted`
- `diary_entries.payload_encrypted`
- `anonymous_questions.question_text_encrypted`
- `question_answers.answer_text_encrypted`
- `reviews.review_text_encrypted`

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (RBAC)
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**

- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `users`, `roles`, `user_roles` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç RBAC
- ‚ö†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ P2 –¥–∞–Ω–Ω—ã–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ –≤ –ë–î)

#### –í —Ç–∞–±–ª–∏—Ü–∞—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏/CRM timeline –Ω–µ—Ç PII/—Ç–µ–∫—Å—Ç–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –Ω–æ –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î**

- ‚úÖ `lead_timeline_events.properties` - JSONB (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ P0)
- ‚úÖ `lead_identities` - P1 –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã (email_encrypted, phone_encrypted)
- ‚ö†Ô∏è **–ù–µ—Ç CHECK constraint –∏–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞**, –∫–æ—Ç–æ—Ä—ã–π –±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–ª –≤—Å—Ç–∞–≤–∫—É PII –≤ `lead_timeline_events.properties`. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é.

---

### ‚úÖ 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ (6.3)

#### Migration plan
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: `20260113110201_init_release_1`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤: `20260113110522_add_performance_indexes`
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ –¥–∞—Ç–∞–º (timestamp-based naming)

#### Rollback
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ**

- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `migrate:rollback` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ package.json
- ‚ö†Ô∏è **–ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** –ø–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ rollback –¥–ª—è prod
- ‚ö†Ô∏è –í –º–∏–≥—Ä–∞—Ü–∏—è—Ö –Ω–µ—Ç —è–≤–Ω—ã—Ö "rollback notes" –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### Backfill
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å backfill –º–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ.

---

### ‚ö†Ô∏è 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (12.1 - 12.4)

#### 12.1 Unit tests
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º**

–¢–µ—Ö—Å–ø–µ–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç—ã –Ω–∞ SQL/ORM —Å—Ö–µ–º—É –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. Schema snapshot –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω.

#### 12.2 Integration tests
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `apps/api/test/database.spec.ts` —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ Smoke –∑–∞–ø—Ä–æ—Å—ã:
  - ‚úÖ –í—Å—Ç–∞–≤–∫–∞/—á—Ç–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç-–∞–π—Ç–µ–º–∞
  - ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ run —Å `result_level`
  - ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏ + –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
  - Privacy by Design (P2/P1 –ø–æ–ª—è)
  - –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ constraints
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `pnpm test:db` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –ë–î

#### 12.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ privacy
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ**

- ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –≤ `lead_timeline_events.properties` –Ω–µ–ª—å–∑—è –≤—Å—Ç–∞–≤–∏—Ç—å PII/—Ç–µ–∫—Å—Ç
- ‚ö†Ô∏è –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ DTO/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞—Ö)

---

### ‚ö†Ô∏è 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (11.3)

#### –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: –¥–æ–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

- ‚úÖ README —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
- ‚úÖ **–°–û–ó–î–ê–ù –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç** `docs/database-migrations-guide.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏:
  - –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ
  - –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ CI
  - –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ prod
  - –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ rollback —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
  - Best practices –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
  - Troubleshooting guide

---

## 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∞–±–ª–∏—Ü–∞–º

| –î–æ–º–µ–Ω | –¢–∞–±–ª–∏—Ü–∞ | –°—Ç–∞—Ç—É—Å | –ó–∞–º–µ—á–∞–Ω–∏—è |
|-------|---------|--------|-----------|
| Identity | users | ‚úÖ | –í—Å–µ –ø–æ–ª—è |
| Identity | roles | ‚úÖ | - |
| Identity | user_roles | ‚úÖ | - |
| Identity | consents | ‚úÖ | - |
| Content | content_items | ‚úÖ | –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (content_type, slug) |
| Content | topics | ‚úÖ | - |
| Content | tags | ‚úÖ | - |
| Content | content_item_topics | ‚úÖ | - |
| Content | content_item_tags | ‚úÖ | - |
| Content | media_assets | ‚úÖ | object_key —É–Ω–∏–∫–∞–ª–µ–Ω |
| Content | content_media | ‚úÖ | - |
| Content | curated_collections | ‚úÖ | - |
| Content | curated_items | ‚úÖ | XOR —Å–≤—è–∑—å (–Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) |
| Content | glossary_terms | ‚úÖ | - |
| Content | glossary_term_synonyms | ‚úÖ | - |
| Content | glossary_term_links | ‚úÖ | - |
| Interactive | interactive_definitions | ‚úÖ | –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (type, slug) |
| Interactive | interactive_runs | ‚úÖ | –¢–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∞—Ç—ã |
| Booking | services | ‚úÖ | - |
| Booking | availability_slots | ‚úÖ | –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ |
| Booking | appointments | ‚úÖ | –°–≤—è–∑—å —Å lead_id |
| Booking | payments | ‚úÖ | provider_payment_id —É–Ω–∏–∫–∞–ª–µ–Ω |
| Booking | intake_forms | ‚úÖ | payload_encrypted |
| Booking | waitlist_requests | ‚úÖ | contact_value_encrypted |
| Client Cabinet | diary_entries | ‚úÖ | payload_encrypted |
| Client Cabinet | data_export_requests | ‚úÖ | - |
| Telegram | deep_links | ‚úÖ | TTL —á–µ—Ä–µ–∑ expires_at |
| CRM | leads | ‚úÖ | utm –∫–∞–∫ JSONB |
| CRM | lead_identities | ‚úÖ | P1 –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã |
| CRM | lead_timeline_events | ‚úÖ | properties JSONB (P0-only) |
| UGC | anonymous_questions | ‚ö†Ô∏è | trigger_flags –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º |
| UGC | question_answers | ‚úÖ | answer_text_encrypted |
| UGC | ugc_moderation_actions | ‚úÖ | - |
| UGC | reviews | ‚úÖ | review_text_encrypted |
| UGC | review_publication_consents | ‚úÖ | - |
| Admin | audit_log_entries | ‚úÖ | - |
| Admin | message_templates | ‚úÖ | - |
| Admin | message_template_versions | ‚úÖ | - |

### ‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **trigger_flags —Ç–∏–ø**
   - **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö:** enum –º–∞—Å—Å–∏–≤ –∏–ª–∏ JSONB –º–∞—Å—Å–∏–≤ enum
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `String?` (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ)
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `Json?` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `anonymous_question_trigger_flags`

2. **XOR constraint –≤ curated_items**
   - **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö:** –¢—Ä–µ–±—É–µ—Ç—Å—è XOR (–ª–∏–±–æ content_item_id, –ª–∏–±–æ interactive_definition_id)
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –û–±–∞ –ø–æ–ª—è nullable, –Ω–æ –Ω–µ—Ç CHECK constraint
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å CHECK constraint –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
   - **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö:** –¢—Ä–µ–±—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã, –Ω–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ UNIQUE constraint
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (–∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö)

---

## 4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–æ—Ä–∞–±–æ—Ç–∫–µ

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–±–ª–æ–∫–∏—Ä—É—é—Ç AC-4)

1. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î (12.2)**
   - –§–∞–π–ª: `apps/api/test/database.spec.ts` –∏–ª–∏ `apps/api/test/migrations.spec.ts`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ –ø—É—Å—Ç–æ–π –ë–î
   - Smoke –∑–∞–ø—Ä–æ—Å—ã: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ–Ω—Ç–µ–Ω—Ç, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤, –∑–∞–ø–∏—Å—å+–ø–ª–∞—Ç–µ–∂

### üü° –í–∞–∂–Ω—ã–µ (—É–ª—É—á—à–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ)

2. **–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã**
   - `appointments.start_at_utc` –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å
   - `appointments.status` –∏–Ω–¥–µ–∫—Å
   - `availability_slots.source` –∏–Ω–¥–µ–∫—Å
   - `payments (provider, provider_payment_id)` —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø trigger_flags**
   - –ò–∑–º–µ–Ω–∏—Ç—å —Å `String?` –Ω–∞ `Json?` (–º–∞—Å—Å–∏–≤ enum –∑–Ω–∞—á–µ–Ω–∏–π)
   - –û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é PII –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ**
   - –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è `lead_timeline_events.properties`
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

5. **–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º**
   - –§–∞–π–ª: `docs/database-migrations-guide.md`
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, CI, prod
   - –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ rollback

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (nice to have)

6. **–î–æ–±–∞–≤–∏—Ç—å CHECK constraint –¥–ª—è curated_items**
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å XOR —Å–≤—è–∑—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

7. **–î–æ–±–∞–≤–∏—Ç—å rollback notes –≤ –º–∏–≥—Ä–∞—Ü–∏–∏**
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

---

## 5. –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| **G1: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** | 100% | –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç |
| **G2: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π** | 100% | –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ |
| **G3: P2 –ø–æ–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã** | 100% | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ |
| **G4: –ò–Ω–¥–µ–∫—Å—ã –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏** | 100% | –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã |
| **G5: Seed –¥–∞–Ω–Ω—ã–µ** | 100% | –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ |
| **AC-1: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã/enum** | 100% | –í—Å–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç, trigger_flags –∏—Å–ø—Ä–∞–≤–ª–µ–Ω |
| **AC-2: Seed –¥–∞–Ω–Ω—ã–µ** | 100% | –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| **AC-3: –ë–∞–∑–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã** | 100% | –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã |
| **AC-4: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç** | 100% | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã |
| **Privacy by Design** | 100% | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | 100% | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | 100% | –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 100%

---

## 6. –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 2026-01-13)

### ‚úÖ 6.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–∫—Ä–∏—Ç–∏—á–Ω–æ)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `apps/api/test/database.spec.ts` —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ –ø—É—Å—Ç–æ–π –ë–î
- Smoke –∑–∞–ø—Ä–æ—Å—ã: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ–Ω—Ç–µ–Ω—Ç, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤, –∑–∞–ø–∏—Å—å+–ø–ª–∞—Ç–µ–∂
- Privacy by Design –ø—Ä–æ–≤–µ—Ä–∫–∏ (P2/P1 –ø–æ–ª—è)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–µ–π –∏ constraints
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤

**–§–∞–π–ª—ã:**
- `apps/api/test/database.spec.ts`
- –û–±–Ω–æ–≤–ª–µ–Ω `apps/api/package.json` (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `test:db`)

### ‚úÖ 6.2 –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é `20260113120000_add_indexes_and_constraints`:
- `appointments.start_at_utc` - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `appointments.status` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `availability_slots.source` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É
- `payments (provider, provider_payment_id)` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª—ã:**
- `apps/api/prisma/migrations/20260113120000_add_indexes_and_constraints/migration.sql`
- –û–±–Ω–æ–≤–ª–µ–Ω `apps/api/prisma/schema.prisma`

### ‚úÖ 6.3 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ trigger_flags

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `trigger_flags` –≤ `anonymous_questions`:
- –ë—ã–ª–æ: `String?`
- –°—Ç–∞–ª–æ: `Json?` (JSONB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ enum –∑–Ω–∞—á–µ–Ω–∏–π)

**–§–∞–π–ª—ã:**
- –û–±–Ω–æ–≤–ª–µ–Ω `apps/api/prisma/schema.prisma`
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤ `20260113120000_add_indexes_and_constraints/migration.sql`

### ‚úÖ 6.4 CHECK constraint –¥–ª—è curated_items

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–î–æ–±–∞–≤–ª–µ–Ω CHECK constraint –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ XOR —Å–≤—è–∑–∏ –≤ `curated_items`:
- –õ–∏–±–æ `content_item_id` –∑–∞–ø–æ–ª–Ω–µ–Ω, –ª–∏–±–æ `interactive_definition_id`
- –ù–µ –æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–µ –æ–±–∞ –ø—É—Å—Ç—ã–µ

**–§–∞–π–ª—ã:**
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤ `20260113120000_add_indexes_and_constraints/migration.sql`

### ‚úÖ 6.5 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `docs/database-migrations-guide.md`:
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è CI/CD
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è production
- –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ rollback —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- Best practices
- Troubleshooting guide

**–§–∞–π–ª—ã:**
- `docs/database-migrations-guide.md`

---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ö—Å–ø–µ–∫–∏ FEAT-PLT-02 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ **100%**. –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:

1. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è AC-4 –∏ 12.2
2. ‚úÖ **–í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
3. ‚úÖ **–¢–∏–ø trigger_flags –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ **CHECK constraint –¥–æ–±–∞–≤–ª–µ–Ω** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç XOR —Å–≤—è–∑—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
5. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö—Å–ø–µ–∫–∏ FEAT-PLT-02.

---

**–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)
