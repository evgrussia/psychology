# Техническая спецификация фичи (Tech Spec)

**Проект:** «Эмоциональный баланс»  
**Версия спеки:** v0.1 (draft)  
**Автор:** Cursor Agent  
**Дата:** 2026-01-07  
**Статус:** draft  

**Feature ID:** `FEAT-WEB-01`  
**Epic:** `EPIC-01`  
**Приоритет:** P0  
**Трекер:** —  

**Оценка реализации агентом Cursor:** ~90k токенов (≤ 270k)

---

## 1) Summary (коротко)

### 1.1 Что делаем
Делаем главную страницу как “путь клиента” с быстрым входом в пользу (карточки тем/состояний + первый шаг за 1–3 минуты) и встроенными блоками доверия, чтобы пользователь за ≤3 клика дошёл до интерактива/Telegram/записи.

### 1.2 Почему сейчас (контекст / метрики / риск)
- **Сигнал/боль:** PRD требует time-to-benefit и доверие “на входе”.
- **Ожидаемый эффект:** рост `start_quiz`, `complete_quiz`, `booking_start`, `cta_tg_click`.
- **Если не сделать:** низкая конверсия “visit → полезное действие → запись”.

### 1.3 Ссылки на первоисточники
- PRD: `docs/PRD.md` (FR-HP-1..4)
- IA: `docs/information-architecture.md` (`/`)
- Flows: `docs/user-flows-cjm.md`
- UI kit: `docs/UI-Kit-Design-System.md`
- Copy: `docs/Content-Guide-UX-Copywriting.md`
- Tracking: `docs/Tracking-Plan.md`

---

## 2) Goals / Non-goals

### 2.1 Goals (что обязательно)
- **G1:** `/` содержит карточки 3–5 тем релиза 1 (из PRD: тревога/выгорание/отношения/границы/самооценка).
- **G2:** На главной есть “первый шаг” (вход в `/start/*`) и понятный CTA: “Запись” (primary) + “Telegram/продолжение” (secondary) с объяснением.
- **G3:** Блоки доверия на главной: “как проходит”, “границы/конфиденциальность”, мини‑FAQ.
- **G4:** Перелинковка в контент (статьи/ресурсы) и интерактивы.

### 2.2 Non-goals (что осознанно НЕ делаем)
- **NG1:** Полный SEO‑кластер (это EPIC-02, отдельные лендинги).
- **NG2:** A/B на главной (P2).

---

## 3) Scope (границы и сценарии)

### 3.1 In-scope (конкретные сценарии)
- **US-1:** Гость открывает `/`, выбирает карточку темы → попадает на лендинг темы или интерактив.
- **US-2:** Гость выбирает “С чего начать” → попадает в `/start/` и запускает интерактив.
- **US-3:** Пользователь видит trust‑блоки, раскрывает FAQ.

### 3.2 Out-of-scope
- Авторизация/ЛК.

### 3.3 Acceptance criteria (AC)
- [ ] AC-1 Из главной за ≤3 клика можно перейти в интерактив/запись/о психологе.
- [ ] AC-2 Есть состояния loading/empty/error для “подтягиваемых” блоков (если контент приходит с API).
- [ ] AC-3 Все ключевые CTA и trust взаимодействия трекаются по Tracking Plan.

### 3.4 Негативные сценарии (обязательные)
- **NS-1:** Нет контента/интерактивов в БД → показываем graceful fallback (статический “первый шаг”).
- **NS-2:** Ошибка API → UI показывает бережную ошибку и альтернативу (“перейти к записи”).

---

## 4) UX / UI (что увидит пользователь)

### 4.1 Изменения экранов/страниц
- **Маршруты/страницы:** `/` (главная), ссылки на `/start/*`, `/booking/`, `/about/`, `/how-it-works/`, `/s-chem-ya-pomogayu/*`.
- **Состояния UI:** loading / error / success.
- **Копирайт/тон:** эмпатично, без давления (см. Content guide).

### 4.2 A11y (минимум)
- [ ] Семантические заголовки (H1/H2).
- [ ] Карточки тем доступны с клавиатуры (button/link).
- [ ] Видимый фокус, контраст.

---

## 5) Архитектура и ответственность слоёв (Clean Architecture)

### 5.1 Компоненты/модули
- **Presentation:** web page `/` + компоненты (Hero, TopicCards, FirstStepCTA, TrustBlocks, FAQ).
- **Application:** read-model use cases:
  - `GetHomepageModelUseCase`
  - `GetTopicsUseCase` (если темы динамические)
- **Domain:** `Topic` (каталог), `ContentItem` (для превью).
- **Infrastructure:** content repository (read), cache (опционально).

### 5.2 Основные use cases (сигнатуры)
- `GetHomepageModelUseCase.execute({ locale }): { topics[], featured_interactives[], trust_blocks[] }`

### 5.3 Доменные события (если нужны)
Не нужны.

---

## 6) Модель данных (БД) и миграции

### 6.1 Новые/изменённые сущности
Не требуются (используем topics/content/interactives из `FEAT-PLT-02`, `FEAT-CNT-01`, `FEAT-INT-01`).

### 6.2 P0/P1/P2 классификация данных
Только P0 (topic code, slugs).

### 6.3 Миграции
Нет.

---

## 7) API / Контракты (если применимо)

### 7.1 Public API (web)
Если главная рендерится из API:
| Endpoint | Method | Auth | Request | Response | Ошибки |
|---|---:|---|---|---|---|
| `/api/public/homepage` | GET | public | — | `200 {topics, blocks}` | 500 |

### 7.2 Admin API
Не применимо.

### 7.3 Интеграции (внешние)
Не применимо.

---

## 8) Tracking / Analytics (по `docs/Tracking-Plan.md`)

### 8.1 События (таблица)
| Event name | Source | Когда срабатывает | Props (P0-only) | Запреты |
|---|---|---|---|---|
| `view_problem_card` | web | клик по карточке темы | `topic`, `card_slug`, `page_path=/` | — |
| `trust_block_viewed` | web | видимость блока доверия | `trust_block`, `page_path=/` | — |
| `faq_opened` | web | раскрыли FAQ | `faq_id`, `page_path=/` | — |
| `cta_click` | web | клик CTA | `cta_id`, `cta_target` | — |

### 8.2 Воронка / метрики успеха
- **Primary KPI:** рост `booking_start` и `cta_tg_click` с главной.
- **Secondary KPI:** `start_quiz`/`navigator_start` с главной.

---

## 9) Security / Privacy / Compliance

### 9.1 Privacy by design (обязательные пункты)
- [ ] В событиях нет PII/текста.

### 9.2 RBAC и аудит
Не применимо.

### 9.3 Кризисный режим (если применимо)
Если на главной есть “экстренная помощь” ссылка — она всегда доступна (см. WEB-03).

---

## 10) Надёжность, производительность, деградации

### 10.1 SLA/SLO (если критично)
- Быстрый LCP: минимизируем JS, используем SSR/SSG для `/`.

### 10.2 Retry / idempotency
Не применимо.

### 10.3 Деградации (fallback)
- При недоступности API главная должна отрендериться в “базовом” варианте (статическая структура + ссылки).

---

## 11) Rollout plan

### 11.1 Фича‑флаг / поэтапное включение
- `homepage_v1_enabled` (stage → prod).

### 11.2 Миграция данных и обратимость
Не требуется.

### 11.3 Коммуникации (если нужно)
Не требуется.

---

## 12) Test plan

### 12.1 Unit tests
- компоненты карточек/CTA.

### 12.2 Integration tests
- `/api/public/homepage` (если есть) возвращает ожидаемую модель.

### 12.3 E2E (критические happy paths)
- `/` → клик “Запись” → `/booking/`
- `/` → клик карточки темы → `/s-chem-ya-pomogayu/{topic}/`

### 12.4 Проверка privacy
- [ ] в payload событий нет запрещённых полей

### 12.5 A11y smoke
- [ ] таб по карточкам, видимый фокус

---

## 13) Open questions / решения

### 13.1 Вопросы
- [ ] Показывать ли “ближайшие слоты” на главной (в IA отмечено как вопрос). Рекомендация: **не показывать** на главной в релиз 1 (снижает сложность и риски).

### 13.2 Decision log (что и почему решили)
- **2026-01-07:** главная SSR/SSG, time-to-benefit и trust‑блоки обязательны, без A/B.

