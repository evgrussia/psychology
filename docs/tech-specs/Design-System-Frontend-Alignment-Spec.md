# Техническая спецификация: приведение фронтенда к стандартам Design System

**Проект:** «Эмоциональный баланс»  
**Версия спеки:** v0.1 (draft)  
**Автор:** Cursor Agent  
**Дата:** 2026-01-19  
**Статус:** draft  

**Feature ID:** `FEAT-DS-02`  
**Epic:** `EPIC-00 — Platform & Foundations` (кросс‑срез)  
**Приоритет:** P0  
**Трекер:** TBD  

---

## 1) Summary (коротко)

### 1.1 Что делаем
Приводим **весь фронтенд проекта** к стандартам `@psychology/design-system` — все публичные страницы, интерактивные флоу и админ‑панель. Убираем расхождения в композициях, типографике, отступах, состояниях и CTA, опираясь на компоненты и токены дизайн‑системы.

### 1.2 Почему сейчас
- **Сигнал/боль:** текущая верстка ряда страниц не совпадает с эталонными DS‑шаблонами (разный визуальный ритм, компоненты и состояния).
- **Ожидаемый эффект:** визуальная консистентность, корректная темизация light/dark, ускорение дальнейших итераций.
- **Если не сделать:** UI продолжит расходиться с дизайн‑системой, растет стоимость поддержки и риск регрессов.

### 1.3 Ссылки на первоисточники
- Design System: `design-system/docs/DESIGN_SYSTEM.md`
- Developer Guide: `design-system/docs/DEVELOPER_GUIDE.md`
- Tokens: `design-system/docs/TOKENS.md`
- UI kit docs: `docs/UI-Kit-Design-System.md`

---

## 2) Goals / Non-goals

### 2.1 Goals (что обязательно)
- **G1:** Все страницы `apps/web` и `apps/admin` используют компоненты и токены DS (без хардкода цветов/отступов).
- **G2:** Контентные страницы (`/about`, `/blog`, `/blog/[slug]`, `/resources`, `/glossary`, `/curated`, `/legal/*`) соответствуют DS‑композициям.
- **G3:** Интерактивные флоу `/start/*`, `/booking/*`, `/interactive/*` соответствуют DS‑паттернам (hero, карточки, CTA, empty/error).
- **G4:** Админ‑панель использует DS‑таблицы, фильтры, статусы и карточки (Admin Kit).
- **G5:** Типографика, отступы и состояния фокуса соответствуют токенам DS по всему проекту.

### 2.2 Non-goals (что осознанно НЕ делаем)
- **NG1:** Изменение контента или IA сайта (тексты остаются как в CMS).
- **NG2:** Переписывание дизайн‑системы или её токенов.
- **NG3:** Пересборка backend/контрактов; это только фронтенд‑выравнивание.

---

## 3) Scope (границы и сценарии)

### 3.1 In-scope (конкретные сценарии)
- **US-1:** Пользователь открывает любую публичную страницу `apps/web` и видит структуру из DS‑блоков (Hero/Section/Container/CTA и т.д.).
- **US-2:** Любая контентная страница (`/blog`, `/blog/[slug]`, `/resources`, `/glossary`, `/curated`, `/legal/*`) использует DS‑карточки/бейджи/мета/empty/error.
- **US-3:** Любой интерактивный маршрут (`/start/*`, `/interactive/*`, `/booking/*`) имеет DS‑композицию и единые состояния.
- **US-4:** Любой экран админ‑панели использует Admin Kit (таблицы, фильтры, статусные плашки, карточки).

### 3.2 Out-of-scope
- Изменение API контрактов CMS и серверных схем.
- Полный редизайн UX (меняем только реализацию на DS).

### 3.3 Acceptance criteria (AC)
- [ ] **AC-1:** В `apps/web` и `apps/admin` отсутствует хардкод цветов/отступов; используются DS‑токены и компоненты.
- [ ] **AC-2:** Контентные страницы используют DS‑композиции и имеют единые empty/error состояния.
- [ ] **AC-3:** Интерактивные флоу используют DS‑карточки/CTA/типографику и доступные состояния.
- [ ] **AC-4:** Админ‑панель соответствует Admin Kit (таблицы, фильтры, статусные плашки).
- [ ] **AC-5:** Light/Dark тема корректно отображает все ключевые страницы (визуальный smoke).

### 3.4 Негативные сценарии (обязательные)
- **NS-1:** Пустые списки (blog/resources/curated) → DS‑empty state.
- **NS-2:** Ошибки загрузки данных → DS‑error state.

---

## 4) UX / UI (что увидит пользователь)

### 4.1 Изменения экранов/страниц
- **Маршруты/страницы:** все публичные страницы `apps/web`, все интерактивные флоу `/start/*` и `/interactive/*`, все шаги `/booking/*`, все экраны `apps/admin`.
- **Состояния UI:** empty/error/loading/hover/focus — через DS‑паттерны.
- **Копирайт/тон:** без изменений, нейтральный и поддерживающий.

### 4.2 A11y (минимум)
- [ ] Навигация с клавиатуры по карточкам/CTA.
- [ ] Видимый `focus-visible` на интерактивных элементах.
- [ ] Семантические теги (`h1`, `h2`, `section`, `nav` где уместно).
- [ ] Контраст соответствует токенам DS.

---

## 5) Архитектура (frontend)

### 5.1 Компоненты/модули
- **Presentation (web):** `apps/web/src/app/**`
- **Presentation (admin):** `apps/admin/src/app/**`
- **Shared UI:** `@psychology/design-system` (UI + domain + shared components)
- **Контент:** `apps/web/src/lib/content` (без изменений контрактов)

### 5.2 Предлагаемое решение (high-level)
- Ввести DS‑представления для ключевых экранов (web/admin) и выровнять все шаблоны страниц под DS‑паттерны.
- Привести `SafeMarkdownRenderer` и все markdown‑обертки к DS‑типографике и токенам.
- Сохранить существующий tracking/SEO без изменений.

---

## 6) Модель данных (БД) и миграции
Не требуется (frontend‑изменения).

---

## 7) API / Контракты
Не требуется (контракты CMS остаются прежними).

---

## 8) Tracking / Analytics
Без изменений. Текущие события `page_view` и `cta_click` должны сохраняться.

---

## 9) Security / Privacy
Без изменений. Не добавлять PII в логи/события.

---

## 10) Надёжность, производительность, деградации
- Не ухудшить LCP/CLS на публичных страницах.
- При недоступности CMS/интерактивов — отображать fallback/empty состояния в DS‑стиле.

---

## 11) Rollout plan
Без фича‑флагов. Внедрение по этапам:
1) Контентные страницы (blog/resources/glossary/curated/legal/about/how‑it‑works)
2) Интерактивные флоу (`/start/*`, `/interactive/*`, `/booking/*`)
3) Админ‑панель (`apps/admin`)

---

## 12) Test plan

### 12.1 Unit tests
Не требуется (стилевые/структурные изменения).

### 12.2 Integration tests
Не требуется.

### 12.3 E2E (критические happy paths)
- Публичные контентные страницы рендерятся без ошибок и соответствуют DS‑структуре.
- Интерактивные флоу `/start/*` и `/booking/*` корректно отображают DS‑состояния.
- Админ‑страницы отображают таблицы/фильтры/статусы из Admin Kit.

### 12.4 A11y smoke
- Tab‑навигация, видимый фокус, читаемость в dark на ключевых разделах web/admin.

---

## 13) Open questions / решения

### 13.1 Вопросы
- [ ] Нужен ли единый DS‑компонент для markdown‑типографики (`Prose`)?
- [ ] Нужна ли унификация CTA‑секции между контентными страницами?

### 13.2 Decision log
- **2026-01-19:** Источник истины по компонентам и токенам — `@psychology/design-system`. Любые отклонения фиксируются через отдельные DS‑компоненты, а не локальный хардкод.
